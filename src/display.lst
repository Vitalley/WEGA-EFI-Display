MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ; Исправлена ошибка зависания дисплея
                      00002 ; 10,12,15 Вывод температуры в полном формате без таблицы, ошибка около 2,5%
                      00003 ; 11.12.15 Вывод расхода топлива литры, час
                      00004 ; 04.01.16 Исправлен вывод  дробных чисел
                      00005 ; 03.03.16 Добавлена проверка на максимальный и минимальный размер пакета 
                      00006 ; 08.07.16 Добавлена библитека вывода с удлиннёнными состояниями на выходе (lcdslow.inc)
                      00007 ; 08.07.16 Диначеское отображение информации в зависимости от состояния
                      00008 ; 27.07.16 Мелкие исправления в коде
                      00009 ; 31.10.16 Добавлена обработка прерывания INTF
                      00010 ; 02.02.18 Добавлена проверка флага ошибки приёма байт
                      00011 ; 24.05.18 Перенесена функция управления подсветкой из прерывания в основной цикл - это вызывало подвиса
                            ние дисплея
                      00012 ; 03.11.21 Добавлена возможность работы с универсальной характеристикой ДАД
                      00013 
                      00014         list      p=16f628a           ; list directive to define processor
                      00015 ;       #include <C:\Program Files\MPLAB IDE\MCHIP_Tools\p16F628a.inc>       ; processor specific variab
                            le definitions
                      00016         #include <p16F628a.inc>
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ;  MPASM PIC16F628A processor include
                      00005 ; 
                      00006 ;  (c) Copyright 1999-2013 Microchip Technology, All rights reserved
                      00007 ;==========================================================================
                      00008 
                      00385         LIST
                      00017         errorlevel  -302              ; suppress message 302 from list file
                      00018         #include macro.inc
                      00001 jz      macro   LBL     
                      00002         btfsc   STATUS,Z
                      00003         goto    LBL
                      00004         endm
                      00005 jnz     macro   LBL     
                      00006         btfss   STATUS,Z
                      00007         goto    LBL
                      00008         endm
                      00009 jc      macro   LBL     
                      00010         btfss   STATUS,C
                      00011         goto    LBL
                      00012         endm
                      00013 jnc     macro   LBL     
                      00014         btfsc   STATUS,C
                      00015         goto    LBL
                      00016         endm
                      00017 bank0   macro
                      00018         bcf     STATUS,RP0
                      00019         bcf     STATUS,RP1
                      00020         endm
                      00021 bank1   macro
                      00022         bsf     STATUS,RP0
                      00023         bcf     STATUS,RP1
                      00024         endm
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00025 bank2   macro
                      00026         bcf     STATUS,RP0
                      00027         bsf     STATUS,RP1
                      00028         endm
                      00029 bank3   macro
                      00030         bsf     STATUS,RP0
                      00031         bsf     STATUS,RP1
                      00032         endm
                      00033 let     macro   aa,bb   
                      00034         movlw   bb
                      00035         movwf   aa
                      00036         endm
                      00037 movab macro     aa,bb   
                      00038         movfw   aa
                      00039         movwf   bb
                      00040         endm
                      00041 
                      00019 
2007   3F21           00020  __CONFIG _CP_OFF & _WDT_OFF & _BODEN_OFF & _PWRTE_ON & _XT_OSC & _LVP_OFF
                      00021 
                      00022 ;====================================================================
                      00023 ;
                      00024 ;            DISPLAY 16х2 FOR WEGA INJECTION SYSTEM
                      00025 ;
                      00026 ;====================================================================
                      00027         
                      00028 ; Переменные
  0000007F            00029 W_TEMP  EQU             07F
                      00030 
                      00031         cblock  20
                      00032 
  00000020            00033 AF
  00000021            00034 NNN
  00000022            00035 BBB
  00000023            00036 CCC
  00000024            00037 DDD
                      00038 
  00000025            00039 STAT            ; Отображает режим работы (побитовый) [0]-Motor on [1]-Warm_Up on [2]-IAC [3]-Accel [4]-
                            D.Accel [5]-ЭПХХ [6]-ЭМР [7] AFTER START ENR
  00000026            00040 ERR             ; Биты ошибок Bit:[0]-WDT, [1]-BOR, [2]-T.Inj, [3]-Err.Copm, [4]-COLT,[5]-MAP
  00000027            00041 STPCNT          ; Позиция шагового двигателя
  00000028            00042 A_TMP           ; *Показания ДТВ
  00000029            00043 COLT            ; Показания ДТОЖ
  0000002A            00044 MAP             ; Разряжение 0FH -Offset, 0FAH - 100КПа
  0000002B            00045 TPS             ; Положение дроссельной заслонки <14H IAC
  0000002C            00046 O2S             ; Показаняи датчика кислорода
  0000002D            00047 POWER           ; Напряжение боротовой сети/10,2
  0000002E            00048 SPD             ; Обороты двигателя
  0000002F            00049 T_INJ_L
  00000030            00050 T_INJ_H         ; Время впрыска(мкс)
                      00051 ;
  00000031            00052 INJ_LAG_L 
  00000032            00053 INJ_LAG_H
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00054 
  00000033            00055 RqFl            ; Время впрыска при давлении 110КПа
  00000034            00056 RqFh
  00000035            00057 RCO_L   ; Время впрыска при пуске на холодную 30ms
  00000036            00058 RCO_H
  00000037            00059 MCKl    ; ; Счётчик моточасов
  00000038            00060 MCKh
  00000039            00061 WARM_80         ; Обогащение при прогреве горячего вдигателя (+80)
  0000003A            00062 WARM_20         ; Обогащение при прогреве холодного двигателя (-40)
                      00063 
  0000003B            00064 res1 
                      00065                 ;
  0000003C            00066 WARM_40
  0000003D            00067 WARM_50
  0000003E            00068 D_TPS           ; Delta TPS
  0000003F            00069 ENR_12
                      00070 
  00000040            00071 res2            ; 
  00000041            00072 ExtConfig
                      00073 
  00000042            00074 UOZ             
  00000043            00075 IAT     
                      00076 
  00000044            00077 SPD_ENR
  00000045            00078 WARM_ENR                ; ENRICHMENT
                      00079 
  00000046            00080         Temp    ; (LCD)-флаг busy и текущий адрес DDRAM
  00000047            00081         Char    ; (LCD)-cохранение при выводе символа или команды
  00000048            00082         temp1, temp2
  0000004A            00083         STATUS_TEMP
  0000004B            00084         PCLATH_TEMP
  0000004C            00085         FLAG    ; Флаги приёма пакетов [0]- AF ,[1]- 00,[2]-version, [3]-Size
  0000004D            00086         FLAG2   ; [0]- хз, [1]- флаг приятия данных, [2]- флаг обновления дисплея [3] - флаг переноса от
                            ображения рхх более 99 [7]- регулировка подсветки
  0000004E            00087         SIZE    ; Размер пакета (получает в посылке)
  0000004F            00088         BT_CNT  ; Сётчик байт приёма
  00000050            00089         IN_CNT          ; Счётчик приёма
  00000051            00090         CHK_SUM_RX      ; Контрольная сумма приёма
  00000052            00091         Colt1
  00000053            00092         SPDCNTh ; Счётчик скорости
  00000054            00093         SPDCNTl
  00000055            00094         SPEED   ; Скорость
  00000056            00095            DispEr ; Счётчик ожидания готовности ЖКИ
  00000057            00096         BLINK   ;РЕГИСТР МЕРЦАНИЯ
  00000058            00097         LPG_LEVEL;Уровень газа
  00000059            00098         cnt1,cnt2       ;регистры программируемой задержки
  0000005B            00099         rab,rab0,rab1,rab2,rab3,count,aargb2,aargb1,temp
  00000064            00100 MULc            ; 8 bit multiplicand
  00000065            00101 MULp            ; 8 bit multiplier
  00000066            00102 H_byte          ; High byte of the 16 bit result
  00000067            00103 L_byte          ; Low byte of the 16 bit result
                      00104 
  00000068            00105 APRX_BUFF:16    ; Buffer
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  0000007E            00106 APRX_B_IND
                      00107         endc
                      00108 
                      00109 ; Назначение портов дисплея
  00000006            00110 LCD_DATA         EQU     PORTB
  00000086            00111 LCD_DATA_TRIS    EQU     TRISB
                      00112 
                      00113 #define E       PORTB,3 ;Сигнал управления Е
                      00114 #define RW      PORTA,2 ;Сигнал управления R/W
                      00115 #define RS      PORTA,3 ;Сигнал управления RS
                      00116 
                      00117 #DEFINE BRIGHT  PORTA,4 ;Порт регулировки яркости дисплея
                      00118 
                      00119 #DEFINE VERSION 010H     ; ВЕРСИЯ ПРИНИМАЕМОГО ПАКЕТА(другие не принимает)
                      00120 
                      00121 ;Параметры настройки компараторов для измерения уровня топлива
                      00122 ; VRCON voltage 1010xxxx
                      00123 #DEFINE LPG_L   b'10101110'     ; >2.9V Обрыв датчика уровня топлива
                      00124 #DEFINE LPG_FULL        b'10101010'     ; <2.08v
                      00125 #DEFINE LPG_L3  b'10100110'     ; <1.25v
                      00126 #DEFINE LPG_L2  b'10100100'     ; <0.83v
                      00127 #DEFINE LPG_L1  b'10100010'     ; <0.42v
                      00128 #DEFINE LPG_NULL        b'10100001'     ; <0.21v
                      00129 
                      00130 
0000                  00131         ORG     0               ; processor reset vector
0000   0000           00132         NOP
0001   281B           00133         GOTO    INIT            ; go to beginning of program
                      00134 ;------------------------------------------------------------------
                      00135 ;               ОБРАБОТКА ПРЕРЫВАНИЙ
                      00136 ;------------------------------------------------------------------
0004                  00137         ORG     4               ; Вектор прерываний
0004   00FF           00138         MOVWF   W_TEMP          ; Копировать W во временный регистр независимо от текущего банка
0005   0E03           00139         SWAPF   STATUS,W                ; Обменять полубайты в регистре STATUS и записать в W           
0006   0183           00140         CLRF    STATUS          ;
0007   00CA           00141         MOVWF   STATUS_TEMP     ; Сохранить STATUS во временном регистре банка 0
0008   080A           00142         MOVF    PCLATH, W               ;
0009   00CB           00143         MOVWF   PCLATH_TEMP             ;
000A   018A           00144         CLRF    PCLATH          ;
000B   188B           00145         btfsc   INTCON,INTF             ;импульс датчика скорости
000C   2A19           00146         goto    WHEEL
                      00147 ;       BTFSC   PIR1,CCP1IF             ;
                      00148 ;       GOTO    COMP_EVNT
000D   180C           00149         BTFSC   PIR1,TMR1IF             ; Проверка переполнение таймера ТМР1
000E   2A23           00150         GOTO    TMR_OF
000F   190B           00151         BTFSC   INTCON,T0IF
0010   2A13           00152         GOTO    TMR_EV          ; Проверка переполнение таймера ТМР0
0011   1A8C           00153         BTFSC   PIR1,RCIF       ; USART Rx?
0012   2A28           00154         GOTO    Int_Rx
0013   2814           00155         GOTO    RET
                      00156 ;------------------------ INT exit-----------------------
0014   084B           00157 RET     MOVF    PCLATH_TEMP, W  ;
0015   008A           00158         MOVWF   PCLATH          ;
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0016   0E4A           00159         SWAPF   STATUS_TEMP,W   ;Обменять полубайты оригинального значения STATUS и записать в W (восста
                            новить текущий банк)
0017   0083           00160         MOVWF   STATUS          ;Восстановить значение STATUS из регистра W
0018   0EFF           00161         SWAPF   W_TEMP,F                ;Обменять полубайты в регистре W_TEMP и сохранить результат в W_
                            TEMP
0019   0E7F           00162         SWAPF   W_TEMP,W                ;Обменять полубайты в регистре W_TEMP и восстановить оригинально
                            е значение W без воздействия на STATUS
001A   0009           00163         RETFIE
                      00164 
                      00165 
                      00166 ;------------------------------------------------------------------
                      00167 ;                       ИНИЦИАЛИЗАЦИЯ
                      00168 ;------------------------------------------------------------------
                      00169 INIT    bank1
001B   1683               M         bsf     STATUS,RP0
001C   1303               M         bcf     STATUS,RP1
                      00170         let     TRISA,b'00000011'
001D   3003               M         movlw   b'00000011'
001E   0085               M         movwf   TRISA
                      00171         let     TRISB,b'00000011'
001F   3003               M         movlw   b'00000011'
0020   0086               M         movwf   TRISB
                      00172         let     OPTION_REG,b'10000111'  ; Подтягивающие резисторы включены(Предделитель на tmr0)
0021   3087               M         movlw   b'10000111'
0022   0081               M         movwf   OPTION_REG
                      00173         let     PIE1,B'00100001'        ; Записать маску прерываний в регистр PIE1
0023   3021               M         movlw   B'00100001'
0024   008C               M         movwf   PIE1
                      00174         let     VRCON,B'10100001'
0025   30A1               M         movlw   B'10100001'
0026   009F               M         movwf   VRCON
                      00175 ; Настройка УСАРТ
0027   3019           00176         MOVLW   .25                     ; Установить скорость обмена данными(F=9615 Hz)
0028   0099           00177         MOVWF   SPBRG
0029   3024           00178         MOVLW   B'00100100'             ; Передача 8 - разрядных данных, включить передатчик,
002A   0098           00179         MOVWF   TXSTA           ; ВЫСОКОСКОРОСТНОЙ асинхронный режим
                      00180 
                      00181         ;BSF      PIE1,TXIE,0           ; Разрешить прерывания от передатчика USART
002B   168C           00182         BSF      PIE1,RCIE              ; Разрешить прерывания от приемника USART    
                      00183 
                      00184 
                      00185         bank0
002C   1283               M         bcf     STATUS,RP0
002D   1303               M         bcf     STATUS,RP1
002E   0064           00186         CLRWDT
002F   3090           00187         MOVLW   B'10010000'             ; РАБОТА ПОРТА РАЗРЕШЕНА 8 БИТ ДАННЫХ
0030   0098           00188         MOVWF   RCSTA           ; включить модуль USART
                      00189         let     CMCON,b'00000010'       ; Настраиваем компараторы 
0031   3002               M         movlw   b'00000010'
0032   009F               M         movwf   CMCON
0033   0186           00190         CLRF    PORTB
0034   0185           00191         CLRF    PORTA
0035   0181           00192         CLRF    TMR0
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0036   01CC           00193         CLRF    FLAG
0037   01CD           00194         CLRF    FLAG2
0038   01CF           00195         CLRF    BT_CNT
0039   01D1           00196         CLRF    CHK_SUM_RX
003A   01A6           00197         CLRF    ERR
003B   0064           00198         CLRWDT
                      00199         let     LPG_LEVEL,.7
003C   3007               M         movlw   .7
003D   00D8               M         movwf   LPG_LEVEL
                      00200 ;       let     INTCON,B'11010000'      ; ГЛОБАЛЬНЕО РАЗРЕШЕНИЕ ПРЕРЫВАНИЙ
                      00201         let     T1CON,B'00000000'       ; Инициализация ТМР1, предделитель 1:8
003E   3000               M         movlw   B'00000000'
003F   0090               M         movwf   T1CON
                      00202         let     INTCON,B'11110000'      ; ГЛОБАЛЬНЕО РАЗРЕШЕНИЕ ПРЕРЫВАНИЙ
0040   30F0               M         movlw   B'11110000'
0041   008B               M         movwf   INTCON
                      00203 
0042   238D           00204         CALL    LCD_Init        ; Инициализация дисплея
                      00205 
0043   0064           00206         CLRWDT  
0044   3001           00207         MOVLW   CLR_DISP        ;
0045   2356           00208         CALL    Send_Cmd
0046   300C           00209         MOVLW   DISP_ON 
0047   2356           00210         CALL    Send_Cmd
0048   3006           00211         MOVLW   ENTRY_INC       
0049   2356           00212         CALL    Send_Cmd
                      00213 ;
004A   0064           00214         CLRWDT
                      00215 
                      00216 ;       CALL    Wait_Busy       ; Чтение текущего адреса ОЗУ ЖКИ
004B   23AD           00217         CALL    SET_CGRAM
004C   0064           00218         CLRWDT  
004D   3001           00219         MOVLW   01      ;Очистка дисплея
004E   2356           00220         CALL    Send_Cmd
004F   3080           00221         MOVLW   LINE1
0050   2356           00222         CALL    Send_Cmd
                      00223 
                      00224 
                      00225         let     temp1,.15
0051   300F               M         movlw   .15
0052   00C8               M         movwf   temp1
0053   3004           00226         MOVLW   HIGH LOGO
0054   008A           00227         MOVWF   PCLATH
0055   3000           00228         MOVLW   LOW LOGO
0056   00C9           00229         MOVWF   temp2
0057   22C5           00230         CALL    READ_STR
0058   2343           00231         CALL    sch_b
0059   0AC9           00232         INCF    temp2,F
005A   0BC8           00233         DECFSZ  temp1,F
005B   2857           00234         GOTO    $-4
                      00235 
                      00236 
                      00237 
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

005C   30C0           00238 NN      MOVLW   LINE2
005D   2356           00239         CALL    Send_Cmd
005E   0064           00240         CLRWDT
                      00241 
                      00242 
                      00243 
                      00244         let     temp1,.5
005F   3005               M         movlw   .5
0060   00C8               M         movwf   temp1
0061   3004           00245         MOVLW   HIGH N_CON
0062   008A           00246         MOVWF   PCLATH
0063   3010           00247         MOVLW   LOW N_CON
0064   00C9           00248         MOVWF   temp2
0065   22C5           00249         CALL    READ_STR
0066   2343           00250         CALL    sch_b
0067   0AC9           00251         INCF    temp2,F
0068   0BC8           00252         DECFSZ  temp1,F
0069   2865           00253         GOTO    $-4
                      00254 
006A   2703           00255  CALL SPEEDW
                      00256 
006B   0064           00257         CLRWDT
006C   29A4           00258         GOTO    FUEL
                      00259 
                      00260 
                      00261 
                      00262 
006D   18CD           00263 CC      BTFSC   FLAG2,1
006E   2870           00264         GOTO    CCNXT
                      00265 ;       CALL    DELAY
006F   285C           00266         GOTO    NN
0070   0064           00267 CCNXT   CLRWDT
0071   1D4D           00268         BTFSS   FLAG2,2
0072   286D           00269         GOTO    CC
0073   114D           00270         BCF     FLAG2,2
                      00271 ;MOVLW  01      ;Очистка дисплея
                      00272 ;       call    Send_Cmd
                      00273 
                      00274 
0074   3080           00275         MOVLW   LINE1
0075   2356           00276         CALL    Send_Cmd
                      00277 
0076   3001           00278         MOVLW   01H
0077   1925           00279         BTFSC   STAT,2  ;ХХ
0078   3000           00280         MOVLW   00H
0079   19A5           00281         BTFSC   STAT,3  ;акселератор
007A   30D9           00282         MOVLW   0D9H
007B   1A25           00283         BTFSC   STAT,4  ;деакселератор
007C   30DA           00284         MOVLW   0DAH
007D   1AA5           00285         BTFSC   STAT,5  ; ЭПХХ
007E   3003           00286         MOVLW   03H
007F   1B25           00287         BTFSC   STAT,6  ; ЭМР
0080   3002           00288         MOVLW   02H
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0081   1C25           00289         BTFSS   STAT,0  ; проверка пуска двигателя
0082   2885           00290         GOTO    $+3
0083   1BA5           00291         BTFSC   STAT,7  ; Прогрев после пуска показывает только на заведённом двигателе
0084   30ED           00292         MOVLW   0EDH
0085   2343           00293         CALL    sch_b
                      00294 
                      00295 
                      00296 ;----------------------------------------------
                      00297 ;       Вывод тахометра
                      00298 ;----------------------------------------------
0086   082E           00299         Movfw   SPD
0087   00E4           00300         MOVWF   MULc
                      00301         let     MULp,.25
0088   3019               M         movlw   .25
0089   00E5               M         movwf   MULp
008A   231E           00302         CALL    MUL8
                      00303 
008B   0867           00304         Movfw   L_byte
008C   00E1           00305         MOVWF   aargb2
008D   0866           00306         Movfw   H_byte
008E   00E2           00307         MOVWF   aargb1
008F   22E9           00308         CALL    BCD16   ;Преобразование к десятичному виду
                      00309 
                      00310 
0090   085C           00311         MOVF    rab0,w  ;Тысячи на дисплей
0091   3E30           00312         ADDLW   30
0092   2343           00313         CALL    sch_b
0093   085D           00314         MOVF    rab1,w  ;Сотни на дисплей
0094   3E30           00315         ADDLW   30
0095   2343           00316         CALL    sch_b
0096   085E           00317         MOVF    rab2,w  ;Десятки на дисплей
0097   3E30           00318         ADDLW   30
0098   2343           00319         CALL    sch_b
0099   085F           00320         MOVF    rab3,w  ;Единицы на дисплей
009A   3E30           00321         ADDLW   30
009B   2343           00322         CALL    sch_b
                      00323 
                      00324 ;       movlw   020H
                      00325 ;       call    sch_b
                      00326 ;-----------------------------------------
                      00327 ;       вывод температуры
                      00328 ;-----------------------------------------
009C   1E26           00329         BTFSS   ERR,4   ;Проверяем ошибу ДТОЖ
009D   28A9           00330         GOTO    CLT
009E   1DD7           00331         BTFSS   BLINK,3 ; РЕГИСТР МОРГАНИЯ
009F   28A9           00332         GOTO    CLT
00A0   3020           00333         MOVLW   20      ; ОЧИЩАЕМ ЗНАКОМЕСТА
00A1   2343           00334         CALL    sch_b
00A2   3020           00335         MOVLW   20
00A3   2343           00336         CALL    sch_b
00A4   3020           00337         MOVLW   20
00A5   2343           00338         CALL    sch_b
00A6   3020           00339         MOVLW   20
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00A7   2343           00340         CALL    sch_b
00A8   28C0           00341         GOTO    CLT_EX  ; 
                      00342 
                      00343 
00A9                  00344 CLT
00A9   302C           00345         MOVLW   .44     ; отрицательные температуры 45
00AA   0228           00346         SUBWF   A_TMP,W
00AB   00D2           00347         MOVWF   Colt1
00AC   3020           00348         MOVLW   20
00AD   1803           00349         BTFSC   STATUS,C
00AE   28B3           00350         GOTO    $+5
                      00351 
00AF   0852           00352         Movfw   Colt1
00B0   3C00           00353         SUBLW   .0
00B1   00D2           00354         MOVWF   Colt1
00B2   302D           00355         MOVLW   '-'     ; -
                      00356 
00B3   2343           00357         CALL    sch_b
00B4   0852           00358         Movfw   Colt1
00B5   00E1           00359         MOVWF   aargb2
00B6   01E2           00360         CLRF    aargb1  
00B7   22E9           00361         CALL    BCD16   ;Преобразование к десятичному виду
                      00362 
00B8   085E           00363         MOVF    rab2,w  ;Сотни на дисплей
00B9   3E30           00364         ADDLW   30
00BA   2343           00365         CALL    sch_b
00BB   085F           00366         MOVF    rab3,w  ;Десятки на дисплей
00BC   3E30           00367         ADDLW   30
00BD   2343           00368         CALL    sch_b
                      00369         
00BE   3004           00370         MOVLW   04H     ; градусы
00BF   2343           00371         CALL    sch_b
00C0                  00372 CLT_EX
                      00373 
                      00374 ;----------------------------------------------
                      00375 ;       Вывод напряжения на дисплей
                      00376 ;----------------------------------------------
00C0   082D           00377         Movfw   POWER
00C1   00E1           00378         MOVWF   aargb2
00C2   01E2           00379         CLRF    aargb1
                      00380 
00C3   22E9           00381 conv    CALL    BCD16   ;Преобразование к десятичному виду
                      00382 
00C4   085D           00383         MOVF    rab1,w  ;Тысячи на дисплей
00C5   3E30           00384         ADDLW   30
00C6   2343           00385         CALL    sch_b
00C7   085E           00386         MOVF    rab2,w  ;Сотни на дисплей
00C8   3E30           00387         ADDLW   30
00C9   2343           00388         CALL    sch_b
                      00389 
00CA   19CD           00390         BTFSC   FLAG2,3 ; Флаг больших шагов РХХ, освобождаем знакоместо
00CB   28D1           00391         GOTO    $+6
00CC   302C           00392         MOVLW   ','     ; ЗПТ
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00CD   2343           00393         CALL    sch_b
00CE   085F           00394         MOVF    rab3,w  ;Десятки на дисплей
00CF   3E30           00395         ADDLW   30
00D0   2343           00396         CALL    sch_b
                      00397 
00D1   3007           00398         MOVLW   07H
00D2   2343           00399         CALL    sch_b
                      00400 
                      00401 
                      00402 ;----------------------------------------------
                      00403 ;       Вывод позиции РХХ
                      00404 ;----------------------------------------------
                      00405 
00D3   0827           00406         Movfw   STPCNT
00D4   00E1           00407         MOVWF   aargb2
00D5   01E2           00408         CLRF    aargb1
00D6   22E9           00409         CALL    BCD16   ;Преобразование к десятичному виду
                      00410 
                      00411 
00D7   085D           00412         MOVF    rab1,w  ;Тысячи на дисплей
00D8   1903           00413         BTFSC   STATUS,Z
00D9   28DE           00414         GOTO    $+5
00DA   3E30           00415         ADDLW   30
00DB   2343           00416         CALL    sch_b
00DC   15CD           00417         BSF     FLAG2,3 ; Флаг переноса, число шаков более 99
00DD   28DF           00418         GOTO    $+2
00DE   11CD           00419         BCF     FLAG2,3 ;
00DF   085E           00420         MOVF    rab2,w  ;Сотни на дисплей
00E0   3E30           00421         ADDLW   30
00E1   2343           00422         CALL    sch_b
00E2   085F           00423         MOVF    rab3,w  ;Десятки на дисплей
00E3   3E30           00424         ADDLW   30
00E4   2343           00425         CALL    sch_b
                      00426 
00E5   30C1           00427         MOVLW   0C1h
00E6   2343           00428         CALL    sch_b
                      00429 ;       MOVLW   020H
                      00430 ;       CALL    sch_b
                      00431 ; ВТОРАЯ ЛИНИЯ
00E7   0064           00432         CLRWDT
00E8   30C0           00433         MOVLW   LINE2
00E9   2356           00434         CALL    Send_Cmd
00EA   1825           00435         BTFSC   STAT,0  ;пуск двигателя
00EB   2914           00436         GOTO    SCR1
                      00437 ;вывод моточасов
00EC   0837           00438         Movfw   MCKl
00ED   00E1           00439         MOVWF   aargb2
00EE   0838           00440         Movfw   MCKh
00EF   00E2           00441         MOVWF   aargb1
00F0   22E9           00442         CALL    BCD16   ;Преобразование к десятичному виду
                      00443 
00F1   304D           00444         MOVLW   'M'
00F2   2343           00445         CALL    sch_b   
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00F3   306F           00446         MOVLW   'o'
00F4   2343           00447         CALL    sch_b   
00F5   3074           00448         MOVLW   't'
00F6   2343           00449         CALL    sch_b   
00F7   306F           00450         MOVLW   'o'
00F8   2343           00451         CALL    sch_b   
00F9   303A           00452         MOVLW   ':'
00FA   2343           00453         CALL    sch_b   
00FB   085B           00454         MOVF    rab,w   ;Десятки Тысяч на дисплей
00FC   3E30           00455         ADDLW   30
00FD   2343           00456         CALL    sch_b
00FE   085C           00457         MOVF    rab0,w  ;Тысячи на дисплей
00FF   3E30           00458         ADDLW   30
0100   2343           00459         CALL    sch_b
0101   085D           00460         MOVF    rab1,w  ;Сотни на дисплей
0102   3E30           00461         ADDLW   30
0103   2343           00462         CALL    sch_b
0104   085E           00463         MOVF    rab2,w  ;Десятки на дисплей
0105   3E30           00464         ADDLW   30
0106   2343           00465         CALL    sch_b
0107   085F           00466         MOVF    rab3,w  ;Единицы на дисплей
0108   3E30           00467         ADDLW   30
0109   2343           00468         CALL    sch_b
010A   3068           00469         MOVLW   'h'
010B   2343           00470         CALL    sch_b   
010C   3020           00471         MOVLW   20
010D   2343           00472         CALL    sch_b
010E   3045           00473         MOVLW   'E'
010F   2343           00474         CALL    sch_b   
0110   26F0           00475         CALL HEXWIEV    ; Вывод кода ошибки EFI
                      00476 
0111   3020           00477         MOVLW   20
0112   2343           00478         CALL    sch_b   
                      00479 
                      00480 
0113   29A4           00481  GOTO FUEL
                      00482 
                      00483 
0114   3006           00484 SCR1    MOVLW   06
0115   2343           00485         CALL    sch_b   
                      00486         
                      00487 ;-------------------------
                      00488 ; Вывод показания ДАД
                      00489 ;-------------------------
0116   1EA6           00490         BTFSS   ERR,5   ;Проверяем ошибу ДАД
0117   291E           00491         GOTO    $+7
0118   1DD7           00492         BTFSS   BLINK,3 ; РЕГИСТР МОРГАНИЯ
0119   291E           00493         GOTO    $+5
011A   3020           00494         MOVLW   20      ; ОЧИЩАЕМ ЗНАКОМЕСТА
011B   2343           00495         CALL    sch_b
011C   3020           00496         MOVLW   20
011D   293C           00497         GOTO    MAR_EX  ; ВТОРОЕ ЗНАКОМЕСТО ОЩИШАЕТСЯ ПОСЛЕ ПЕРХОДА
011E   082A           00498         Movfw   MAP
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00499 ;       BTFSS   ExtConfig,0
                      00500 ;       GOTO    OLDMAP
011F   3EF0           00501         ADDLW   -.16
0120   1C03           00502         BTFSS   STATUS,C
0121   2939           00503         GOTO    MAP_OFF 
0122   3006           00504         MOVLW   HIGH MAP_Trans2
0123   008A           00505         MOVWF   PCLATH
0124   292B           00506         GOTO    MAP_Tr  
                      00507         
0125   3EF0           00508 OLDMAP  ADDLW   -.16
0126   3E29           00509         ADDLW   -(.230-.16+.1)
0127   1803           00510         BTFSC   STATUS,C
0128   2939           00511         GOTO    MAP_OFF
0129   3005           00512         MOVLW   HIGH MAP_Trans
012A   008A           00513         MOVWF   PCLATH
012B   3010           00514 MAP_Tr  MOVLW   .16
012C   022A           00515         SUBWF   MAP,W
012D   00C9           00516         MOVWF   temp2
012E   22C5           00517         CALL    READ_STR
012F   00E1           00518         MOVWF   aargb2
0130   01E2           00519         CLRF    aargb1
0131   22E9           00520         CALL    BCD16   ;Преобразование к десятичному виду
0132   085E           00521         MOVF    rab2,w  ;Сотни на дисплей
0133   3E30           00522         ADDLW   30
0134   2343           00523         CALL    sch_b
0135   085F           00524         MOVF    rab3,w  ;Десятки на дисплей
0136   3E30           00525         ADDLW   30
0137   2343           00526         CALL    sch_b
0138   293D           00527         GOTO    $+5
0139   302D           00528 MAP_OFF MOVLW   "-"
013A   2343           00529         CALL    sch_b
013B   302D           00530         MOVLW   "-"
013C   2343           00531 MAR_EX  CALL    sch_b
                      00532 
013D   304B           00533         MOVLW   "K"
013E   2343           00534         CALL    sch_b
013F   30BE           00535         MOVLW   0BEH
0140   2343           00536         CALL    sch_b
                      00537 
0141   3020           00538         MOVLW   020
0142   2343           00539         CALL    sch_b
                      00540 
0143   1CA5           00541         BTFSS   STAT,1
0144   2961           00542         GOTO    VEH
                      00543 ;-----------------------------------------------
                      00544 ;       обогащение на прогреве
                      00545 ;-----------------------------------------------
                      00546         bank1
0145   1683               M         bsf     STATUS,RP0
0146   1303               M         bcf     STATUS,RP1
0147   0845           00547         Movfw   WARM_ENR
                      00548         bank0
0148   1283               M         bcf     STATUS,RP0
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0149   1303               M         bcf     STATUS,RP1
014A   00E4           00549         MOVWF   MULc
                      00550         let     MULp,.100
014B   3064               M         movlw   .100
014C   00E5               M         movwf   MULp
014D   231E           00551         CALL    MUL8
                      00552 
014E   01E2           00553         CLRF    aargb1
014F   0D67           00554         RLF     L_byte,W
0150   0D66           00555         RLF     H_byte,W
0151   00E1           00556         MOVWF   aargb2
                      00557 
                      00558 
0152   22E9           00559         CALL    BCD16   ;Преобразование к десятичному виду
                      00560 
                      00561 
                      00562 
0153   085D           00563         MOVF    rab1,w  ;Сотни на дисплей
0154   3E30           00564         ADDLW   30
0155   2343           00565         CALL    sch_b
0156   085E           00566         MOVF    rab2,w  ;Десятки на дисплей
0157   3E30           00567         ADDLW   30
0158   2343           00568         CALL    sch_b
0159   085F           00569         MOVF    rab3,w  ;Единицы на дисплей
015A   3E30           00570         ADDLW   30
015B   2343           00571         CALL    sch_b
                      00572 
015C   3025           00573         MOVLW   025H
015D   2343           00574         CALL    sch_b
015E   3020           00575         MOVLW   020H
015F   2343           00576         CALL    sch_b
0160   297A           00577         GOTO    ECON
                      00578 ;-----------------------------------------------
                      00579 ;       обогащение по VE
                      00580 ;-----------------------------------------------
                      00581 
0161   3020           00582 VEH     MOVLW   020
0162   2343           00583         CALL    sch_b
                      00584         bank1
0163   1683               M         bsf     STATUS,RP0
0164   1303               M         bcf     STATUS,RP1
0165   0844           00585         Movfw   SPD_ENR
                      00586         bank0
0166   1283               M         bcf     STATUS,RP0
0167   1303               M         bcf     STATUS,RP1
0168   00E4           00587         MOVWF   MULc
                      00588         let     MULp,.100
0169   3064               M         movlw   .100
016A   00E5               M         movwf   MULp
016B   231E           00589         CALL    MUL8
                      00590 
016C   01E2           00591         CLRF    aargb1
                      00592 ;       RLF     L_byte,W
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00593 ;       RLF     H_byte,W
016D   0866           00594         Movfw   H_byte
016E   00E1           00595         MOVWF   aargb2
016F   22E9           00596         CALL    BCD16   ;Преобразование к десятичному виду
                      00597 
0170   085E           00598         MOVF    rab2,w  ;Десятки на дисплей
0171   3E30           00599         ADDLW   30
0172   2343           00600         CALL    sch_b
                      00601 
0173   085F           00602         MOVF    rab3,w  ;Единицы на дисплей
0174   3E30           00603         ADDLW   30
0175   2343           00604         CALL    sch_b
                      00605 
0176   3025           00606         MOVLW   025H
0177   2343           00607         CALL    sch_b
                      00608 
0178   3020           00609         MOVLW   020
0179   2343           00610         CALL    sch_b
                      00611 
                      00612 ;       MOVLW   020H
                      00613 ;       CALL    sch_b
                      00614 ;test
                      00615 ; CALL HEXWIEV
                      00616 ; Вывод расхода топлива
                      00617 ; умножаем обороты на время впрыска и считаем по таблице
                      00618 ; старшый битт в таблице - точка
017A   082E           00619 ECON    Movfw   SPD
017B   00E4           00620         MOVWF   MULc
017C   0D2F           00621         RLF     T_INJ_L,W
017D   00C8           00622         MOVWF   temp1
017E   0D30           00623         RLF     T_INJ_H,W
017F   00C9           00624         MOVWF   temp2
0180   0D48           00625         RLF     temp1,W
0181   0D49           00626         RLF     temp2,W
                      00627 
                      00628 
0182   00E5           00629         MOVWF   MULp
0183   231E           00630         CALL    MUL8
                      00631 ;       MOVLW   HIGH Fuel
                      00632 ;       MOVWF   PCLATH
                      00633 ;       RLF     L_byte,W
                      00634 ;       RLF     H_byte,W
                      00635 ;       CALL    READ_STR+1
                      00636 
                      00637 ; добавляю новый расчёт
                      00638         
0184   0DE7           00639         RLF     L_byte,F
0185   0DE6           00640         RLF     H_byte,F
0186   0D67           00641         RLF     L_byte,W
0187   0D66           00642         RLF     H_byte,W
                      00643 
                      00644 
                      00645 
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00646 ;       MOVWF   temp2
                      00647 ;       BTFSC   temp2,7
                      00648 ;       XORLW   B'10000000'
0188   00E1           00649         MOVWF   aargb2
0189   01E2           00650         CLRF    aargb1
018A   22E9           00651         CALL    BCD16   ;Преобразование к десятичному виду
                      00652 
                      00653 
018B   08DD           00654         MOVF    rab1,F
018C   1903           00655         BTFSC   STATUS,Z
018D   2995           00656         GOTO    DESL
018E   085D           00657         MOVF    rab1,w  ;Десятки на дисплей
018F   3E30           00658         ADDLW   30
0190   2343           00659         CALL    sch_b
0191   085E           00660         MOVF    rab2,w  ;Десятки на дисплей
0192   3E30           00661         ADDLW   30
0193   2343           00662         CALL    sch_b
0194   299D           00663         GOTO    LTR
                      00664 
                      00665 
                      00666 
                      00667 
                      00668 
                      00669 ;       BTFSS   temp2,7
                      00670 ;       GOTO    $+3
                      00671 ;       MOVLW   "."
                      00672 ;       GOTO    $+3
0195   085E           00673 DESL    MOVF    rab2,w  ;Десятки на дисплей
0196   3E30           00674         ADDLW   30
0197   2343           00675         CALL    sch_b
0198   302E           00676         MOVLW   "."
0199   2343           00677         CALL    sch_b
019A   085F           00678         MOVF    rab3,w  ;Единицы на дисплей
019B   3E30           00679         ADDLW   30
019C   2343           00680         CALL    sch_b
                      00681 
                      00682 
                      00683 
019D   30BB           00684 LTR     MOVLW   0BBH    ; Знак литры
019E   2343           00685         CALL    sch_b
                      00686                 
                      00687 
                      00688 
019F   08DD           00689         MOVF    rab1,F
01A0   1903           00690         BTFSC   STATUS,Z
01A1   29A4           00691         GOTO    FUEL
01A2   3020           00692         MOVLW   020
01A3   2343           00693         CALL    sch_b
                      00694 ; Опознавание включения подсветки и регулировки яркости дисплея
01A4                  00695 FUEL    ; Определение включения освещения
                      00696         bank1
01A4   1683               M         bsf     STATUS,RP0
01A5   1303               M         bcf     STATUS,RP1
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00697         let     VRCON,B'10100011'
01A6   30A3               M         movlw   B'10100011'
01A7   009F               M         movwf   VRCON
                      00698         bank0
01A8   1283               M         bcf     STATUS,RP0
01A9   1303               M         bcf     STATUS,RP1
01AA   22D0           00699         CALL    delay5
01AB   1B1F           00700         BTFSC   CMCON,C1OUT
01AC   17CD           00701         BSF     FLAG2,7;
01AD   1F1F           00702         BTFSS   CMCON,C1OUT
01AE   13CD           00703         BCF     FLAG2,7;
                      00704 
                      00705 ; ПРОВЕРКА НА ОБРЫВ ДАТЧИКА УРОВНЯ
                      00706         bank1
01AF   1683               M         bsf     STATUS,RP0
01B0   1303               M         bcf     STATUS,RP1
                      00707         let     VRCON,LPG_L
01B1   30AE               M         movlw   b'10101110'
01B2   009F               M         movwf   VRCON
                      00708         bank0
01B3   1283               M         bcf     STATUS,RP0
01B4   1303               M         bcf     STATUS,RP1
01B5   22D0           00709         CALL    delay5
01B6   1B9F           00710         BTFSC   CMCON,C2OUT
01B7   29BB           00711         GOTO    $+4
01B8   3000           00712         MOVLW   .0
01B9   00D8           00713         MOVWF   LPG_LEVEL       
01BA   29F9           00714         GOTO    LEVL
                      00715 
                      00716 
                      00717         bank1
01BB   1683               M         bsf     STATUS,RP0
01BC   1303               M         bcf     STATUS,RP1
                      00718         let     VRCON,LPG_FULL
01BD   30AA               M         movlw   b'10101010'
01BE   009F               M         movwf   VRCON
                      00719         bank0
01BF   1283               M         bcf     STATUS,RP0
01C0   1303               M         bcf     STATUS,RP1
01C1   22D0           00720         CALL    delay5
01C2   1B9F           00721         BTFSC   CMCON,C2OUT
01C3   29C7           00722         GOTO    $+4
01C4   3006           00723         MOVLW   .6
01C5   00D8           00724         MOVWF   LPG_LEVEL       
01C6   29F9           00725         GOTO    LEVL
                      00726 
                      00727 
                      00728 
                      00729 
                      00730         bank1
01C7   1683               M         bsf     STATUS,RP0
01C8   1303               M         bcf     STATUS,RP1
                      00731         let     VRCON,LPG_L3
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01C9   30A6               M         movlw   b'10100110'
01CA   009F               M         movwf   VRCON
                      00732         bank0
01CB   1283               M         bcf     STATUS,RP0
01CC   1303               M         bcf     STATUS,RP1
01CD   22D0           00733         CALL    delay5
01CE   1B9F           00734         BTFSC   CMCON,C2OUT
01CF   29D3           00735         GOTO    $+4
01D0   3005           00736         MOVLW   .5
01D1   00D8           00737         MOVWF   LPG_LEVEL       
01D2   29F9           00738         GOTO    LEVL
                      00739 
                      00740         bank1
01D3   1683               M         bsf     STATUS,RP0
01D4   1303               M         bcf     STATUS,RP1
                      00741         let     VRCON,LPG_L2
01D5   30A4               M         movlw   b'10100100'
01D6   009F               M         movwf   VRCON
                      00742         bank0
01D7   1283               M         bcf     STATUS,RP0
01D8   1303               M         bcf     STATUS,RP1
01D9   22D0           00743         CALL    delay5
01DA   1B9F           00744         BTFSC   CMCON,C2OUT
01DB   29DF           00745         GOTO    $+4
01DC   3004           00746         MOVLW   .4
01DD   00D8           00747         MOVWF   LPG_LEVEL       
01DE   29F9           00748         GOTO    LEVL
                      00749 
                      00750         bank1
01DF   1683               M         bsf     STATUS,RP0
01E0   1303               M         bcf     STATUS,RP1
                      00751         let     VRCON,LPG_L1
01E1   30A2               M         movlw   b'10100010'
01E2   009F               M         movwf   VRCON
                      00752         bank0
01E3   1283               M         bcf     STATUS,RP0
01E4   1303               M         bcf     STATUS,RP1
01E5   22D0           00753         CALL    delay5
01E6   1B9F           00754         BTFSC   CMCON,C2OUT
01E7   29EB           00755         GOTO    $+4
01E8   3003           00756         MOVLW   .3
01E9   00D8           00757         MOVWF   LPG_LEVEL       
01EA   29F9           00758         GOTO    LEVL
                      00759 
                      00760         bank1
01EB   1683               M         bsf     STATUS,RP0
01EC   1303               M         bcf     STATUS,RP1
                      00761         let     VRCON,LPG_NULL
01ED   30A1               M         movlw   b'10100001'
01EE   009F               M         movwf   VRCON
                      00762         bank0
01EF   1283               M         bcf     STATUS,RP0
01F0   1303               M         bcf     STATUS,RP1
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

01F1   22D0           00763         CALL    delay5
01F2   1B9F           00764         BTFSC   CMCON,C2OUT
01F3   29F7           00765         GOTO    $+4
01F4   3002           00766         MOVLW   .2
01F5   00D8           00767         MOVWF   LPG_LEVEL       
01F6   29F9           00768         GOTO    LEVL
                      00769 
01F7   3001           00770         MOVLW   .1
01F8   00D8           00771         MOVWF   LPG_LEVEL
                      00772 
                      00773 
01F9                  00774 LEVL    
                      00775 ; Моргание дисплея при ошибках
01F9   0826           00776         MOVF    ERR,W
01FA   3930           00777         ANDLW   B'00110000'
01FB   1903           00778         BTFSC   STATUS,Z
01FC   29FD           00779         GOTO    BRGHT
                      00780 ;       BTFSS   BLINK,3
                      00781 ;       GOTO    BR_UP
                      00782 ;       GOTO    BR_DWN
                      00783 
                      00784 ; Регулировка яркости
01FD   1FCD           00785 BRGHT   BTFSS   FLAG2,7;CMCON,C1OUT
01FE   2A02           00786         GOTO    BR_DWN
01FF   1E05           00787 BR_UP   BTFSS   BRIGHT
0200   1605           00788         BSF     BRIGHT
0201   2A04           00789         GOTO    BR_NEXT
0202   1A05           00790 BR_DWN  BTFSC   BRIGHT
0203   1205           00791         BCF     BRIGHT
                      00792 
0204                  00793 BR_NEXT ;BCF    BRIGHT test port
                      00794 
                      00795 
0204   0B58           00796         DECFSZ  LPG_LEVEL,W     ;LPG Empty?
0205   2A0B           00797         GOTO    LPG_CHAR_S
0206   1DD7           00798         BTFSS   BLINK,3 ; РЕГИСТР МОРГАНИЯ
0207   2A0B           00799         GOTO    LPG_CHAR_S
0208   3020           00800         MOVLW   20      ; ОЧИЩАЕМ ЗНАКОМЕСТА
0209   2343           00801         CALL    sch_b
020A   286D           00802         GOTO    CC
                      00803         
                      00804 
020B   3005           00805 LPG_CHAR_S      MOVLW   05H     ;Код знака топлива
020C   2343           00806         CALL    sch_b
020D   23BD           00807         CALL    LPG_CHAR        ;Обвновление знакогенератора
                      00808 
020E   1C98           00809         BTFSS   RCSTA,OERR      ;Проверка ошибки принятия байт
020F   286D           00810         GOTO    CC
0210   1218           00811         bcf     RCSTA,CREN
0211   1618           00812         BSF     RCSTA,CREN
0212   286D           00813         GOTO CC
                      00814 ;=============================================================
                      00815 ;       TMR 0
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00816 ;=============================================================
0213   110B           00817 TMR_EV  BCF     INTCON,T0IF             ; Сброс флага прерывания
                      00818 
0214   03D7           00819         DECF    BLINK,F
                      00820 
0215   0BD0           00821         DECFSZ  IN_CNT,F                ; Счётчик приёма
0216   2814           00822         GOTO    RET
0217   10CD           00823         BCF     FLAG2,1   ; CLRF        FLAG2 заменим на изменение соответсвующего флага
                      00824 
0218   2AC1           00825         GOTO    CHSM_ERR
                      00826 
                      00827 
                      00828 
                      00829 ; =============================================================
                      00830 ;       Обработка датчика скорости
                      00831 ;==============================================================
0219   1010           00832 WHEEL   bcf     T1CON,TMR1ON    ;выключаем таймер
021A   108B           00833         BCF     INTCON,INTF
021B   080E           00834         movf    TMR1L,W
021C   00D4           00835         movwf   SPDCNTl
021D   080F           00836         movf    TMR1H,W
021E   00D3           00837         movwf   SPDCNTh         ;запоминаем значение таймера
                      00838 
021F   018E           00839         CLRF    TMR1L
0220   018F           00840         CLRF    TMR1H
0221   1410           00841         BSF     T1CON,TMR1ON    ; Включаем таймер
                      00842 
                      00843 
0222   2814           00844         GOTO    RET
                      00845 ;=============================================================
                      00846 ;       TMR 1
                      00847 ;=============================================================
0223   1010           00848 TMR_OF  BCF     T1CON,TMR1ON    ; Останавливаем таймер
0224   100C           00849         BCF     PIR1,TMR1IF             ; Сбрасываем флаг прерывания
0225   018E           00850         CLRF    TMR1L
0226   018F           00851         CLRF    TMR1H
0227   2814           00852         GOTO    RET
                      00853 
                      00854 
                      00855 
                      00856 ; =============================================================
                      00857 ;       Приём данных с COM-порта
                      00858 ;==============================================================
0228   128C           00859 Int_Rx  BCF     PIR1,RCIF
                      00860 
0229   081A           00861         Movfw   RCREG
                      00862 ;       MOVWF   TXREG
                      00863 ;       bank1 
                      00864 ;       BTFSS           TXSTA,TRMT              ; ПЕРЕДАЧА 
                      00865 ;       GOTO             $-1            ; ДАННЫХ
                      00866 ;       bank0
                      00867 
                      00868 
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00869 
022A   19CC           00870         BTFSC   FLAG,3          ; Привём данных
022B   2A57           00871         GOTO    READ_DATA
022C   194C           00872         BTFSC   FLAG,2          ; 
022D   2A4A           00873         GOTO    GET_SIZE
022E   18CC           00874         BTFSC   FLAG,1
022F   2A42           00875         GOTO    GET_VERSION
0230   184C           00876         BTFSC   FLAG,0
0231   2A3A           00877         GOTO    NUL
0232   0ACF           00878         INCF    BT_CNT,F
0233   081A           00879         Movfw   RCREG           ; проверка на байт синхронизации
0234   07D1           00880         ADDWF   CHK_SUM_RX,F    ; считаем контрольную сумму
0235   3AAF           00881         XORLW   0AFH
0236   1D03           00882         BTFSS   STATUS,Z
0237   2AC1           00883         GOTO    CHSM_ERR
0238   144C           00884         BSF     FLAG,0
0239   2814           00885         GOTO    RET
                      00886 
023A   081A           00887 NUL     Movfw   RCREG           ; ПРОВЕРЯЕМ ВТОРОЙ БАЙТ ПАКЕТА
023B   07D1           00888         ADDWF   CHK_SUM_RX,F    ; считаем контрольную сумму
023C   3A01           00889         XORLW   01H
023D   1D03           00890         BTFSS   STATUS,Z
023E   2AC1           00891         GOTO    CHSM_ERR
023F   0ACF           00892         INCF    BT_CNT,F
0240   14CC           00893         BSF     FLAG,1
0241   2814           00894         GOTO    RET
                      00895 
                      00896 
0242   081A           00897 GET_VERSION     Movfw   RCREG
0243   07D1           00898         ADDWF   CHK_SUM_RX,F    ; считаем контрольную сумму     
                      00899         
0244   3C10           00900         SUBLW   VERSION
0245   1D03           00901         BTFSS   STATUS,Z
0246   2AC1           00902         GOTO    CHSM_ERR
                      00903 
0247   0ACF           00904         INCF    BT_CNT,F
0248   154C           00905         BSF     FLAG,2
0249   2814           00906         GOTO    RET
                      00907 
024A   081A           00908 GET_SIZE        Movfw   RCREG
024B   07D1           00909         ADDWF   CHK_SUM_RX,F    ; считаем контрольную сумму
024C   00CE           00910         MOVWF   SIZE
024D   3C40           00911         SUBLW   .64             ; ОГРАНИЧЕНИЕ НА МАКСИМАЛЬНУЮ ДЛИННУ ПАКЕТА
024E   1C03           00912         BTFSS   STATUS,C
024F   2AC1           00913         GOTO    CHSM_ERR
0250   3005           00914         MOVLW   .5              ; ПРОВЕРКА НА МИНИМАЛЬНЫЙ РАЗМЕР ПАКЕТА
0251   024E           00915         SUBWF   SIZE,W  
0252   1C03           00916         BTFSS   STATUS,C
0253   2AC1           00917         GOTO    CHSM_ERR
                      00918 
                      00919 
                      00920 
0254   0ACF           00921         INCF    BT_CNT,F
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00922         
0255   15CC           00923         BSF     FLAG,3
0256   2814           00924         GOTO    RET
                      00925 
0257   0ACF           00926 READ_DATA       INCF    BT_CNT,F
0258   084F           00927         MOVF    BT_CNT,W                ; КОЛИЧЕСТВО БАЙТ В ПАКЕТЕ +1
0259   064E           00928         XORWF   SIZE,W          ;
025A   1903           00929         BTFSC   STATUS,Z                ; ПРОВЕРЯЕМ НА ПЕРЕПОЛНЕНИЕ
025B   2A6B           00930         GOTO    CHK_SUM         ; ОБНУЛЕНИЕ СЧЁТЧИКА И КОНТРОЛЬНОЙ СУММЫ
                      00931 
                      00932 
                      00933         movab   BT_CNT,FSR              ; ЗАГРУЖАЕМ СЧЁТЧИК БАЙТ В РЕГИСТР КОСВЕННОЙ АДРЕСАЦИИ  
025C   084F               M         movfw   BT_CNT
025D   0084               M         movwf   FSR
025E   30A0           00934         MOVLW   0A0H            ; Добавляем начало блока переменных
025F   0784           00935         ADDWF   FSR,F           ; Приращаем FSR на начальное значение
0260   081A           00936         Movfw   RCREG
0261   07D1           00937         ADDWF   CHK_SUM_RX,F    ; считаем контрольную сумму
                      00938         bank1
0262   1683               M         bsf     STATUS,RP0
0263   1303               M         bcf     STATUS,RP1
0264   0080           00939         MOVWF   INDF            ; Сохраняем во временный буфер памяти
                      00940         bank0
0265   1283               M         bcf     STATUS,RP0
0266   1303               M         bcf     STATUS,RP1
                      00941 
                      00942         let     IN_CNT,0FFH             ;СЧЁТЧИК ПРИЁМА
0267   30FF               M         movlw   0FFH
0268   00D0               M         movwf   IN_CNT
0269   144D           00943         BSF     FLAG2,0
                      00944 
026A   2814           00945         GOTO    RET
                      00946 ; Проверяем контрольную сумму
026B   081A           00947 CHK_SUM Movfw   RCREG
026C   0651           00948         XORWF   CHK_SUM_RX,W
026D   1D03           00949         BTFSS   STATUS,Z
026E   2AC1           00950         GOTO    CHSM_ERR
026F   154D           00951         BSF     FLAG2,2
0270   14CD           00952         BSF     FLAG2,1  ;Флаг принятых данных
                      00953         let     IN_CNT,0FFH
0271   30FF               M         movlw   0FFH
0272   00D0               M         movwf   IN_CNT
                      00954 ; Копируем данные в рабочие регистры
                      00955         bank1
0273   1683               M         bsf     STATUS,RP0
0274   1303               M         bcf     STATUS,RP1
0275   0825           00956         Movfw   STAT
                      00957         bank0
0276   1283               M         bcf     STATUS,RP0
0277   1303               M         bcf     STATUS,RP1
0278   00A5           00958         MOVWF   STAT
                      00959         bank1
0279   1683               M         bsf     STATUS,RP0
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

027A   1303               M         bcf     STATUS,RP1
027B   0826           00960         Movfw   ERR
                      00961         bank0
027C   1283               M         bcf     STATUS,RP0
027D   1303               M         bcf     STATUS,RP1
027E   00A6           00962         MOVWF   ERR
                      00963         bank1
027F   1683               M         bsf     STATUS,RP0
0280   1303               M         bcf     STATUS,RP1
0281   0828           00964         Movfw   A_TMP
                      00965         bank0
0282   1283               M         bcf     STATUS,RP0
0283   1303               M         bcf     STATUS,RP1
0284   00A8           00966         MOVWF   A_TMP
                      00967         bank1
0285   1683               M         bsf     STATUS,RP0
0286   1303               M         bcf     STATUS,RP1
0287   0829           00968         Movfw   COLT
                      00969         bank0
0288   1283               M         bcf     STATUS,RP0
0289   1303               M         bcf     STATUS,RP1
028A   00A9           00970         MOVWF   COLT
                      00971         bank1
028B   1683               M         bsf     STATUS,RP0
028C   1303               M         bcf     STATUS,RP1
028D   082E           00972         Movfw   SPD
                      00973         bank0
028E   1283               M         bcf     STATUS,RP0
028F   1303               M         bcf     STATUS,RP1
0290   00AE           00974         MOVWF   SPD
                      00975         bank1
0291   1683               M         bsf     STATUS,RP0
0292   1303               M         bcf     STATUS,RP1
0293   082A           00976         Movfw   MAP
                      00977         bank0
0294   1283               M         bcf     STATUS,RP0
0295   1303               M         bcf     STATUS,RP1
0296   00AA           00978         MOVWF   MAP
                      00979         bank1
0297   1683               M         bsf     STATUS,RP0
0298   1303               M         bcf     STATUS,RP1
0299   0827           00980         Movfw   STPCNT
                      00981         bank0
029A   1283               M         bcf     STATUS,RP0
029B   1303               M         bcf     STATUS,RP1
029C   00A7           00982         MOVWF   STPCNT
                      00983         bank1
029D   1683               M         bsf     STATUS,RP0
029E   1303               M         bcf     STATUS,RP1
029F   082C           00984         Movfw   O2S
                      00985         bank0
02A0   1283               M         bcf     STATUS,RP0
02A1   1303               M         bcf     STATUS,RP1
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02A2   00AC           00986         MOVWF   O2S
                      00987         bank1
02A3   1683               M         bsf     STATUS,RP0
02A4   1303               M         bcf     STATUS,RP1
02A5   082D           00988         Movfw   POWER
                      00989         bank0
02A6   1283               M         bcf     STATUS,RP0
02A7   1303               M         bcf     STATUS,RP1
02A8   00AD           00990         MOVWF   POWER
                      00991         bank1
02A9   1683               M         bsf     STATUS,RP0
02AA   1303               M         bcf     STATUS,RP1
02AB   082F           00992         Movfw   T_INJ_L
                      00993         bank0
02AC   1283               M         bcf     STATUS,RP0
02AD   1303               M         bcf     STATUS,RP1
02AE   00AF           00994         MOVWF   T_INJ_L
                      00995         bank1
02AF   1683               M         bsf     STATUS,RP0
02B0   1303               M         bcf     STATUS,RP1
02B1   0830           00996         Movfw   T_INJ_H
                      00997         bank0
02B2   1283               M         bcf     STATUS,RP0
02B3   1303               M         bcf     STATUS,RP1
02B4   00B0           00998         MOVWF   T_INJ_H
                      00999         bank1
02B5   1683               M         bsf     STATUS,RP0
02B6   1303               M         bcf     STATUS,RP1
02B7   0837           01000         Movfw   MCKl
                      01001         bank0
02B8   1283               M         bcf     STATUS,RP0
02B9   1303               M         bcf     STATUS,RP1
02BA   00B7           01002         MOVWF   MCKl
                      01003         bank1
02BB   1683               M         bsf     STATUS,RP0
02BC   1303               M         bcf     STATUS,RP1
02BD   0838           01004         Movfw   MCKh
                      01005         bank0
02BE   1283               M         bcf     STATUS,RP0
02BF   1303               M         bcf     STATUS,RP1
02C0   00B8           01006         MOVWF   MCKh
                      01007 
02C1                  01008 CHSM_ERR        
02C1   01CC           01009         CLRF    FLAG
02C2   01D1           01010         CLRF    CHK_SUM_RX
02C3   01CF           01011         CLRF    BT_CNT
02C4   2814           01012         GOTO    RET
                      01013 ;=======================================================================================
02C5   0849           01014 READ_STR        MOVF    temp2,W         ; Чтение таблицы DT
02C6   0082           01015         MOVWF   PCL
                      01016 
                      01017 
02C7   3010           01018 delay20 MOVLW   10
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02C8   00D9           01019         MOVWF   cnt1
02C9   01DA           01020         CLRF    cnt2
02CA   0064           01021         CLRWDT
02CB   0BDA           01022         DECFSZ  cnt2,f
02CC   2ACE           01023         GOTO    $+2
02CD   0BD9           01024         DECFSZ  cnt1,f
02CE   2ACA           01025         GOTO    $-4
02CF   0008           01026         RETURN
                      01027 
02D0   0064           01028 delay5  CLRWDT
02D1   3004           01029         MOVLW   4
02D2   00D9           01030         MOVWF   cnt1
02D3   01DA           01031         CLRF    cnt2
02D4   0BDA           01032         DECFSZ  cnt2,f
02D5   2AD7           01033         GOTO    $+2
02D6   0BD9           01034         DECFSZ  cnt1,f
02D7   2AD4           01035         GOTO    $-3
02D8   0000           01036         NOP
02D9   0008           01037         RETURN
                      01038 
02DA   30FF           01039 DELAY   MOVLW   .255
02DB   00D9           01040         MOVWF   cnt1
02DC   01DA           01041         CLRF    cnt2
02DD   0BDA           01042         DECFSZ  cnt2,f
02DE   2AE1           01043         GOTO    $+3
02DF   0064           01044         CLRWDT
02E0   0BD9           01045         DECFSZ  cnt1,f
02E1   2ADD           01046         GOTO    $-4
02E2   0008           01047         RETURN
                      01048 
                      01049 d100mks let temp2,.25
02E3   3019               M         movlw   .25
02E4   00C9               M         movwf   temp2
02E5   0000           01050 dll     NOP                     ;4 x 50 = 100 mkc
02E6   0BC9           01051         DECFSZ temp2,f
02E7   2AE5           01052         GOTO dll
02E8   0008           01053         RETURN
                      01054 
                      01055 ;****************************************************
                      01056 ; Преобразование двухбайтного числа в десятичное
                      01057 ;****************************************************
02E9   1003           01058 BCD16           BCF     STATUS,0        
02EA   3010           01059         MOVLW   .16
02EB   00E0           01060         MOVWF   count
02EC   01DB           01061         CLRF    rab
02ED   01DD           01062         CLRF    rab1
02EE   01DE           01063         CLRF    rab2
02EF   01DF           01064         CLRF    rab3
02F0   0DE1           01065 loop16          RLF     aargb2, F
02F1   0DE2           01066         RLF     aargb1, F
02F2   0DDF           01067         RLF     rab3, F
02F3   0DDE           01068         RLF     rab2, F
02F4   0DDD           01069         RLF     rab1, F
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

02F5   0BE0           01070         DECFSZ  count, F
02F6   2B09           01071         GOTO    adjDEC
                      01072 
                      01073 
02F7   085D           01074         Movfw   rab1            ; добавил распаковку десяток тысяч
02F8   390F           01075         ANDLW   0FH
02F9   00DB           01076         MOVWF   rab
02FA   085E           01077         Movfw   rab2            ; добавил распаковку тысяч
02FB   39F0           01078         ANDLW   0F0
02FC   00DC           01079         MOVWF   rab0
02FD   0EDC           01080         SWAPF   rab0,f
                      01081 
02FE   085E           01082         Movfw   rab2            ; Распаковка BCD
02FF   390F           01083         ANDLW   0F
0300   00DD           01084         MOVWF   rab1
0301   085F           01085         Movfw   rab3
0302   39F0           01086         ANDLW   0F0
0303   00DE           01087         MOVWF   rab2
0304   0EDE           01088         SWAPF   rab2,f
0305   085F           01089         Movfw   rab3
0306   390F           01090         ANDLW   0F
0307   00DF           01091         MOVWF   rab3
0308   3400           01092         RETLW   0
                      01093 
0309   305F           01094 adjDEC          MOVLW   rab3
030A   0084           01095         MOVWF   FSR
030B   2313           01096         CALL    adjBCD
030C   305E           01097         MOVLW   rab2
030D   0084           01098         MOVWF   FSR
030E   2313           01099         CALL    adjBCD
030F   305D           01100         MOVLW   rab1
0310   0084           01101         MOVWF   FSR
0311   2313           01102         CALL    adjBCD
0312   2AF0           01103         GOTO    loop16
0313   3003           01104 adjBCD          MOVLW   3
0314   0700           01105         ADDWF   0,W
0315   00E3           01106         MOVWF   temp
0316   19E3           01107         BTFSC   temp,3          ; test if result > 7
0317   0080           01108         MOVWF   0
0318   3030           01109         MOVLW   30
0319   0700           01110         ADDWF   0,W
031A   00E3           01111         MOVWF   temp
031B   1BE3           01112         BTFSC   temp,7          ; test if result > 7
031C   0080           01113         MOVWF   0               ; save as MSD
031D   3400           01114         RETLW   0
                      01115 
                      01116 
                      01117 
                      01118 ;-----------------------------------------------------------------------
                      01119 ;           Библиотека символов знакогенератора и сообщений
                      01120 ;-----------------------------------------------------------------------
                      01121         #include MUL8X8.ASM
  00000001            00001 SAME    EQU             1
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00002 
                      00003 MULT    MACRO   BIT
                      00004         BTFSC   MULp,BIT
                      00005         ADDWF   H_byte,SAME
                      00006         RRF     H_byte,SAME
                      00007         RRF     L_byte,SAME
                      00008         ENDM
                      00009 
031E   01E6           00010 MUL8    CLRF    H_byte
031F   01E7           00011         CLRF    L_byte
0320   0864           00012         MOVF    MULc,W
0321   1003           00013         BCF     STATUS,C
                      00014         MULT    0
0322   1865               M         BTFSC   MULp,0
0323   07E6               M         ADDWF   H_byte,SAME
0324   0CE6               M         RRF     H_byte,SAME
0325   0CE7               M         RRF     L_byte,SAME
                      00015         MULT    1
0326   18E5               M         BTFSC   MULp,1
0327   07E6               M         ADDWF   H_byte,SAME
0328   0CE6               M         RRF     H_byte,SAME
0329   0CE7               M         RRF     L_byte,SAME
                      00016         MULT    2
032A   1965               M         BTFSC   MULp,2
032B   07E6               M         ADDWF   H_byte,SAME
032C   0CE6               M         RRF     H_byte,SAME
032D   0CE7               M         RRF     L_byte,SAME
                      00017         MULT    3
032E   19E5               M         BTFSC   MULp,3
032F   07E6               M         ADDWF   H_byte,SAME
0330   0CE6               M         RRF     H_byte,SAME
0331   0CE7               M         RRF     L_byte,SAME
                      00018         MULT    4
0332   1A65               M         BTFSC   MULp,4
0333   07E6               M         ADDWF   H_byte,SAME
0334   0CE6               M         RRF     H_byte,SAME
0335   0CE7               M         RRF     L_byte,SAME
                      00019         MULT    5
0336   1AE5               M         BTFSC   MULp,5
0337   07E6               M         ADDWF   H_byte,SAME
0338   0CE6               M         RRF     H_byte,SAME
0339   0CE7               M         RRF     L_byte,SAME
                      00020         MULT    6
033A   1B65               M         BTFSC   MULp,6
033B   07E6               M         ADDWF   H_byte,SAME
033C   0CE6               M         RRF     H_byte,SAME
033D   0CE7               M         RRF     L_byte,SAME
                      00021         MULT    7
033E   1BE5               M         BTFSC   MULp,7
033F   07E6               M         ADDWF   H_byte,SAME
0340   0CE6               M         RRF     H_byte,SAME
0341   0CE7               M         RRF     L_byte,SAME
                      00022 
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0342   3400           00023         RETLW   0
                      01122         #include lcdrout.inc
                      00001 ;**************************************************************
                      00002 ; The LCD Module Subroutines                                      
                      00003 ;**************************************************************
                      00004 
                      00005 ;**************************************************************
                      00006 ;*SendChar - Sends character to LCD                                
                      00007 ;*This routine splits the character into the upper and lower        
                      00008 ;*nibbles and sends them to the LCD, upper nibble first.           
                      00009 ;**************************************************************
                      00010 ;
                      00011 ; LCD Module commands
                      00012 ; ===================
  00000080            00013 LINE1          EQU  0x080   ; Set display to line 1 character 0
  000000C0            00014 LINE2          EQU  0x0C0   ; Set display to line 2 character 0
                      00015 
  00000028            00016 FUNCTION_SET   EQU  0x028   ; 4 bits, 2 lines, 5x7 Font 
                      00017 
                      00018 ;CLR_DISP - clears all display, and cursor home to addr 0
  00000001            00019 CLR_DISP       EQU  0x001   ; Clear the Display
                      00020 
                      00021 ;RTN_HOME - cursor home and display unshifted, DDRAM unchanged
  00000002            00022 RTN_HOME    EQU    0X002
                      00023 
                      00024 ;DISP_... - Display on / off control, C = cursor ON, B = chr pos blink
  0000000C            00025 DISP_ON        EQU  0x00C   ; Display on
  0000000E            00026 DISP_ON_C      EQU  0x00E   ; Display on, Cursor on
  0000000F            00027 DISP_ON_B      EQU  0x00F   ; Display on, Cursor on, Blink cursor
  00000008            00028 DISP_OFF       EQU  0x008   ; Display off
                      00029 
                      00030 ;ENTRY_... - sets entry mode, S = display shift on, INC / DEC cursor move dir
  00000006            00031 ENTRY_INC      EQU  0x006   ;
  00000007            00032 ENTRY_INC_S    EQU  0x007   ;
  00000004            00033 ENTRY_DEC      EQU  0x004   ;                                  
  00000005            00034 ENTRY_DEC_S    EQU  0x005   ;
                      00035 
                      00036 ;SHIFT_. - Cursor & Display shift, S = Display, C = cursor, L = Left, R = Right
  00000010            00037 SHIFT_C_L     EQU  0x010
  00000014            00038 SHIFT_C_R     EQU  0x014
  00000018            00039 SHIFT_S_L     EQU  0x018
  0000001C            00040 SHIFT_S_R     EQU  0x01C
                      00041 
  00000080            00042 DD_RAM_ADDR    EQU  0x080   ; Least Significant 7-bit are for address
  00000080            00043 DD_RAM_UL      EQU  0x080   ; Upper Left coner of the Display
                      00044 
                      00045 
                      00046 
                      00047 
                      00048 ;==============================================================
0343                  00049 sch_b
0343                  00050 Send_Char
0343   00C7           00051         movwf   Char            ; Character to be sent is in W
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0344   2369           00052         call    Wait_Busy       ; Wait for LCD to be ready
0345   300F           00053         movlw   0x0f
0346   0586           00054         andwf   LCD_DATA,F      ; Clear the upper nibble
0347   0847           00055         movf    Char,w          
0348   39F0           00056         andlw   0xF0            ; Get upper nibble
0349   0486           00057         iorwf   LCD_DATA,F      ; Send data to LCD
034A   1105           00058         bcf     RW              ; Set LCD to write
034B   1585           00059         bsf     RS              ; Set LCD to data mode
034C   1586           00060         bsf     E               ; toggle E for LCD
034D   1186           00061         bcf     E
034E   300F           00062         movlw   0x0f
034F   0586           00063         andwf   LCD_DATA,F      ; Clear the upper nibble
0350   0E47           00064         swapf   Char,W
0351   39F0           00065         andlw   0xF0            ; Get lower nibble
0352   0486           00066         iorwf   LCD_DATA,F      ; Send data to LCD
0353   1586           00067         bsf     E               ; toggle E for LCD
0354   1186           00068         bcf     E
0355   0008           00069         return
                      00070 
                      00071 ;**************************************************************
                      00072 ;* Send_Cmd - Sends command to LCD                              
                      00073 ;* This routine splits the command into the upper and lower    
                      00074 ;* nibbles and sends them to the LCD, upper nibble first.      
                      00075 ;**************************************************************
0356                  00076 scmd
0356                  00077 Send_Cmd
0356   00C7           00078         movwf   Char            ; Character to be sent is in W
0357   2369           00079         call    Wait_Busy       ; Wait for LCD to be ready
0358   300F           00080         movlw   0x0f
0359   0586           00081         andwf   LCD_DATA,F      ; Clear the upper nibble
035A   0847           00082         movf    Char,w          
035B   39F0           00083         andlw   0xF0            ; Get upper nibble
035C   0486           00084         iorwf   LCD_DATA,F      ; Send data to LCD
035D   1105           00085         bcf     RW    ; Set LCD to write
035E   1185           00086         bcf     RS     ; Set LCD to command mode
035F   1586           00087         bsf     E      ; toggle E for LCD
0360   1186           00088         bcf     E
0361   300F           00089         movlw   0x0f
0362   0586           00090         andwf   LCD_DATA,F      ; Clear the upper nibble
0363   0E47           00091         swapf   Char,W
0364   39F0           00092         andlw   0xF0            ; Get lower nibble
0365   0486           00093         iorwf   LCD_DATA,F      ; Send data to LCD
0366   1586           00094         bsf     E      ; toggle E for LCD
0367   1186           00095         bcf     E
0368   0008           00096         return
                      00097 
                      00098 ;**************************************************************
                      00099 ;* This routine checks the busy flag, returns when not busy    
                      00100 ;*  Affects:                                                   
                      00101 ;*      Temp - Returned with busy/address                      
                      00102 ;**************************************************************
                      00103 
0369                  00104 Wait_Busy
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0369   1683           00105         bsf     STATUS, RP0     ; Select Register page 1
036A   30F0           00106         movlw   0xf0            ; Set port to input
036B   0406           00107         iorwf   LCD_DATA_TRIS,W ; Only set upper half of port
036C   0086           00108         movwf   LCD_DATA_TRIS
036D   1283           00109         bcf     STATUS, RP0     ; Select Register page 0
036E   1185           00110         bcf     RS              ; Set LCD for Command mode
036F   1505           00111         bsf     RW              ; Setup to read busy flag
0370   1586           00112         bsf     E               ; Set E high
0371   0806           00113         movf    LCD_DATA, W     ; Read upper nibble busy flag, DDRam address
0372   1186           00114         bcf     E               ; Set E low
0373   39F0           00115         andlw   0xF0            ; Mask out lower nibble
0374   00C6           00116         movwf   Temp
0375   1586           00117         bsf     E               ; Toggle E to get lower nibble
0376   0E06           00118         swapf   LCD_DATA, w     ; Read lower nibble busy flag, DDRam address
0377   1186           00119         bcf     E
0378   390F           00120         andlw   0x0F            ; Mask out upper nibble
0379   04C6           00121         iorwf   Temp,f          ; Combine nibbles, RES in Temp !!!!!!!!!!!!!!!
037A   1BC6           00122         btfsc   Temp, 7         ; Check busy flag, high = busy
037B   2B69           00123         goto    Wait_Busy       ; If busy, check again
037C   1105           00124         bcf     RW 
037D   1683           00125         bsf     STATUS, RP0     ; Select Register page 1
037E   300F           00126         movlw   0x0F
037F   0506           00127         andwf   LCD_DATA_TRIS,W
0380   0086           00128         movwf   LCD_DATA_TRIS   ; Set Port for output
0381   1283           00129         bcf     STATUS, RP0     ; Select Register page 0
0382   0008           00130         return
                      00131 
                      00132 ;**************************************************************
0383                  00133 del10mks
0383   2B84           00134         goto $+1
0384   2B85           00135         goto $+1
0385   2B86           00136         goto $+1
0386   2B87           00137         goto $+1
0387   2B88           00138         goto $+1
0388   2B89           00139         goto $+1
0389   2B8A           00140         goto $+1
038A   2B8B           00141         goto $+1
038B   2B8C           00142         goto $+1
038C   0008           00143         return
                      00144 ;**************************************************************
                      00145 ; Initilize the LCD Display Module
                      00146 ;**************************************************************
038D                  00147 LCD_Init:
                      00148 
038D   1186           00149         bcf     E     ; Clear all controll lines
038E   1185           00150         bcf     RS
038F   1105           00151         bcf     RW
0390   22C7           00152         call    delay20         ; Wait for 40ms for LCD to get powered up
0391   22C7           00153         call    delay20
0392   300F           00154         movlw   0x0f
0393   0586           00155         andwf   LCD_DATA,F      ; Clear the upper nibble
0394   3030           00156         movlw   0x030           ; Command for 4-bit interface high nibble
0395   0486           00157         iorwf   LCD_DATA,F      ; Send data to LCD      
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0396   1683           00158         bsf     STATUS, RP0     ; Select Register page 1
0397   300F           00159         movlw   0x0F
0398   0506           00160         andwf   LCD_DATA_TRIS,W
0399   0086           00161         movwf   LCD_DATA_TRIS   ; Set Port for output
039A   1283           00162         BCF     STATUS, RP0     ; Select Register page 0
039B   1586           00163         bsf     E               ; Clock the initalize command to LCD module
039C   1186           00164         bcf     E
039D   22D0           00165         call    delay5          ; Delay for at least 4.1ms before continuing
039E   1586           00166         bsf     E               ; Clock the initalize command to LCD module
039F   1186           00167         bcf     E
03A0   22E3           00168         call    d100mks         ; delay for at least 100usec before continuing
03A1   1586           00169         bsf     E               ; Clock the initalize command to LCD module
03A2   1186           00170         bcf     E
03A3   2369           00171         call    Wait_Busy       ; From here on, the Busy Bit will be valid.
03A4   300F           00172         movlw   0x0f
03A5   0586           00173         andwf   LCD_DATA,F      ; Clear the upper nibble
03A6   3020           00174         movlw   0x020           ; Command for 4-bit interface high nibble 
03A7   0486           00175         iorwf   LCD_DATA,F      ; Send data to LCD      
03A8   1586           00176         bsf     E               ; Clock the initalize command to LCD module
03A9   1186           00177         bcf     E
03AA   3028           00178         movlw   FUNCTION_SET    ; Send the function set command 4-bit I/F, Font, Number of lines
03AB   2356           00179         call    Send_Cmd        ; Can now use the Send_Cmd routine since Busy Bit Valid and in 4bit mode
                            .
                      00180         
                      00181 
                      00182 
03AC   0008           00183         return
                      00184 ; Программирование символов для изображения линейки  
03AD   3040           00185 SET_CGRAM       movlw   40      ; Установка начального адреса CGRAM
03AE   2356           00186         call    Send_Cmd
                      00187 
                      00188 
                      00189 
                      00190         let     temp1,.64
03AF   3040               M         movlw   .64
03B0   00C8               M         movwf   temp1
03B1   3004           00191         MOVLW   HIGH SYM_DOT
03B2   008A           00192         MOVWF   PCLATH
03B3   301B           00193         MOVLW   LOW SYM_DOT
03B4   00C9           00194         MOVWF   temp2
03B5   22C5           00195         CALL    READ_STR
03B6   2343           00196         CALL    sch_b
03B7   0AC9           00197         INCF    temp2,F
03B8   0BC8           00198         DECFSZ  temp1,F
03B9   2BB5           00199         GOTO    $-4
                      00200 
                      00201 
03BA   3080           00202         movlw   80      ; Процедура DDRAM SET
03BB   2356           00203         call    Send_Cmd
03BC   0008           00204         return
                      00205 
03BD   3068           00206 LPG_CHAR        movlw   40+.40  ; Установка начального адреса CGRAM
03BE   2356           00207         call    Send_Cmd
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00208 
03BF   0858           00209         MOVF    LPG_LEVEL,W     ;LPG_LEVE=0
03C0   1D03           00210         BTFSS   STATUS,Z
03C1   2BCE           00211         GOTO    LCHR
                      00212         let     temp1,.8        ; РИСУЕМ ЗНАК ОБРЫВА ДАТЧИКА
03C2   3008               M         movlw   .8
03C3   00C8               M         movwf   temp1
03C4   3004           00213         MOVLW   HIGH SYM_F_ER
03C5   008A           00214         MOVWF   PCLATH
03C6   305B           00215         MOVLW   LOW SYM_F_ER
03C7   00C9           00216         MOVWF   temp2
03C8   22C5           00217         CALL    READ_STR
03C9   2343           00218         CALL    sch_b
03CA   0AC9           00219         INCF    temp2,F
03CB   0BC8           00220         DECFSZ  temp1,F
03CC   2BC8           00221         GOTO    $-4
03CD   0008           00222         RETURN
                      00223 
                      00224         
03CE   308E           00225 LCHR    MOVLW   .142
03CF   2343           00226         CALL    sch_b
03D0   309F           00227         MOVLW   .159
03D1   2343           00228         CALL    sch_b
                      00229 
                      00230 ;       let LPG_LEVEL,4
                      00231 
03D2   3005           00232         MOVLW   .5
03D3   00C8           00233         MOVWF   temp1
03D4   0858           00234 MCH     MOVFW   LPG_LEVEL
03D5   0248           00235         SUBWF   temp1,W
03D6   1C03           00236         BTFSS   STATUS,C
03D7   1903           00237         BTFSC   STATUS,Z
03D8   2BDB           00238         GOTO    $+3
03D9   309F           00239         MOVLW   .159
03DA   2BDC           00240         GOTO    $+2
03DB   3091           00241         MOVLW   .145
03DC   2343           00242         CALL    sch_b
03DD   0BC8           00243         DECFSZ  temp1,F
03DE   2BD4           00244         GOTO    MCH
03DF   309F           00245         MOVLW   .159
03E0   2343           00246         CALL    sch_b
03E1   3080           00247         movlw   80      ; Процедура DDRAM SET
03E2   2356           00248         call    Send_Cmd
03E3   0008           00249         RETURN
                      00250 
03E4   3070           00251 LAMBDA_CHAR     movlw   40+.48  ; Установка начального адреса CGRAM
03E5   2356           00252         call    Send_Cmd
                      00253 
03E6   3080           00254         movlw   80      ; Процедура DDRAM SET
03E7   2356           00255         call    Send_Cmd
03E8   0008           00256         RETURN
                      01123 ;       #include lcdslow.inc ; Вариант с увеличенными задержками между состояниями линий
0400                  01124         ORG     400
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0400   3420 34AF 3443 01125 LOGO    DT      20, 0AFH,"C", 0A9H, 0E0H,20,"WEGA",20,"2015",20
       34A9 34E0 3420 
       3457 3445 3447 
       3441 3420 3432 
       3430 3431 3435 
       3420 
0410   3420 346E 342F 01126 N_CON   DT      20,"n/c       "
       3463 3420 3420 
       3420 3420 3420 
       3420 3420 
                      01127 ; CGRAM
041B   3480 3480 348C 01128 SYM_DOT DT      .128,.128,.140,.158,.158,.140,.128,.128 ; 00H Символ ХХ (точка)
       349E 349E 348C 
       3480 3480 
0423   3480 3484 348E 01129 SYM_O   DT      .128,.132,.142,.145,.145,.142,.132,.128 ; 01H Символ рабочего режима (кружок)
       3491 3491 348E 
       3484 3480 
042B   348E 349F 349B 01130 SYM_BO  DT      .142,.159,.155,.145,.145,.155,.159,.142 ; 02H
       3491 3491 349B 
       349F 348E 
0433   3480 349F 3480 01131 SYM_L   DT      .128,.159,.128,.159,.128,.159,.128,.128 ; 03H
       349F 3480 349F 
       3480 3480 
043B   348C 3492 3492 01132 SYM_DEG DT      .140,.146,.146,.140,.128,.128,.128,.128 ; 04H Знак градуса
       348C 3480 3480 
       3480 3480 
0443   348E 349F 3491 01133 SYM_FUEL        DT      .142,.159,.145,.145,.145,.145,.145,.159 ; Уровень топлива
       3491 3491 3491 
       3491 349F 
044B   3480 3480 3480 01134 SYM_LAMBD       DT      .128,.128,.128,.159,.159,.128,.128,.128 ; Указатель лямбда-зонда
       349F 349F 3480 
       3480 3480 
0453   3480 3480 3480 01135 SYM_V   DT      .128,.128,.128,.128,.148,.148,.136,.128 ; Знак маленькая V - напряжение бортсети
       3480 3494 3494 
       3488 3480 
                      01136 ;SYM_F_ER       DT      .142,.159,.142,.149,.155,.149,.142,.159 ; Знак обрыва датчика уровня топлива (пр
                            и инициализации не загружается. а заменяет знак уровня топлива)
045B   340E 341F 3471 01137 SYM_F_ER        DT      .14,.31,.113,.106,.4,.106,.113,.159 ; Знак обрыва датчика уровня топлива (при ин
                            ициализации не загружается. а заменяет знак уровня топлива)
       346A 3404 346A 
       3471 349F 
                      01138 
                      01139 
                      01140 ;-----------------------------------------------------------------------
                      01141 ;           Таблица преобразования показаний ДАД
                      01142 ;-----------------------------------------------------------------------
                      01143 ; MAP sensor MPX4100 pressure=ОКРУГЛ((B2/5+0,152)/0,01059;0)
0500                  01144         ORG     500
0500   3414 3415 3415 01145 MAP_Trans       DT      .20,.21,.21,.21,.22,.22,.22,.23,.23,.24
       3415 3416 3416 
       3416 3417 3417 
       3418 
050A   3418 3418 3419 01146         DT      .24,.24,.25,.25,.25,.26,.26,.27,.27,.27
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

       3419 3419 341A 
       341A 341B 341B 
       341B 
0514   341C 341C 341C 01147         DT      .28,.28,.28,.29,.29,.30,.30,.30,.31,.31
       341D 341D 341E 
       341E 341E 341F 
       341F 
051E   341F 3420 3420 01148         DT      .31,.32,.32,.32,.33,.33,.34,.34,.34,.35
       3420 3421 3421 
       3422 3422 3422 
       3423 
0528   3423 3423 3424 01149         DT      .35,.35,.36,.36,.37,.37,.37,.38,.38,.38
       3424 3425 3425 
       3425 3426 3426 
       3426 
0532   3427 3427 3428 01150         DT      .39,.39,.40,.40,.40,.41,.41,.41,.42,.42
       3428 3428 3429 
       3429 3429 342A 
       342A 
053C   342A 342B 342B 01151         DT      .42,.43,.43,.44,.44,.44,.45,.45,.45,.46
       342C 342C 342C 
       342D 342D 342D 
       342E 
0546   342E 342F 342F 01152         DT      .46,.47,.47,.47,.48,.48,.48,.49,.49,.50
       342F 3430 3430 
       3430 3431 3431 
       3432 
0550   3432 3432 3433 01153         DT      .50,.50,.51,.51,.51,.52,.52,.52,.53,.53
       3433 3433 3434 
       3434 3434 3435 
       3435 
055A   3436 3436 3436 01154         DT      .54,.54,.54,.55,.55,.55,.56,.56,.57,.57
       3437 3437 3437 
       3438 3438 3439 
       3439 
0564   3439 343A 343A 01155         DT      .57,.58,.58,.58,.59,.59,.60,.60,.60,.61
       343A 343B 343B 
       343C 343C 343C 
       343D 
056E   343D 343D 343E 01156         DT      .61,.61,.62,.62,.62,.63,.63,.64,.64,.64
       343E 343E 343F 
       343F 3440 3440 
       3440 
0578   3441 3441 3441 01157         DT      .65,.65,.65,.66,.66,.67,.67,.67,.68,.68
       3442 3442 3443 
       3443 3443 3444 
       3444 
0582   3444 3445 3445 01158         DT      .68,.69,.69,.70,.70,.70,.71,.71,.71,.72
       3446 3446 3446 
       3447 3447 3447 
       3448 
058C   3448 3448 3449 01159         DT      .72,.72,.73,.73,.74,.74,.74,.75,.75,.75
       3449 344A 344A 
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

       344A 344B 344B 
       344B 
0596   344C 344C 344D 01160         DT      .76,.76,.77,.77,.77,.78,.78,.78,.79,.79
       344D 344D 344E 
       344E 344E 344F 
       344F 
05A0   3450 3450 3450 01161         DT      .80,.80,.80,.81,.81,.81,.82,.82,.82,.83
       3451 3451 3451 
       3452 3452 3452 
       3453 
05AA   3453 3454 3454 01162         DT      .83,.84,.84,.84,.85,.85,.85,.86,.86,.87
       3454 3455 3455 
       3455 3456 3456 
       3457 
05B4   3457 3457 3458 01163         DT      .87,.87,.88,.88,.88,.89,.89,.90,.90,.90
       3458 3458 3459 
       3459 345A 345A 
       345A 
05BE   345B 345B 345B 01164         DT      .91,.91,.91,.92,.92,.92,.93,.93,.94,.94
       345C 345C 345C 
       345D 345D 345E 
       345E 
05C8   345E 345F 345F 01165         DT      .94,.95,.95,.95,.96,.96,.97,.97,.97,.98
       345F 3460 3460 
       3461 3461 3461 
       3462 
05D2   3462 3462 3463 01166         DT      .98,.98,.99,.99,.99
       3463 3463 
0600                  01167         ORG     600
0600   340D 340D 340E 01168 MAP_Trans2      DT      .13,.13,.14,.15,.16,.16,.17,.18,.19,.20,.20,.21,.22,.23,.23,.24,.25,.26,.27,.27,
                            .28,.29,.30
       340F 3410 3410 
       3411 3412 3413 
       3414 3414 3415 
       3416 3417 3417 
       3418 3419 341A 
       341B 341B 341C 
       341D 341E 
0617   341E 341F 3420 01169         DT      .30,.31,.32,.33,.34,.34,.35,.36,.37,.38,.38,.39,.40,.41,.41,.42,.43,.44,.45,.45,.46,.47,
                            .48
       3421 3422 3422 
       3423 3424 3425 
       3426 3426 3427 
       3428 3429 3429 
       342A 342B 342C 
       342D 342D 342E 
       342F 3430 
062E   3430 3431 3432 01170         DT      .48,.49,.50,.51,.52,.52,.53,.54,.55,.55,.56,.57,.58,.59,.59,.60,.61,.62,.63,.63,.64,.65,
                            .66
       3433 3434 3434 
       3435 3436 3437 
       3437 3438 3439 
       343A 343B 343B 
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

       343C 343D 343E 
       343F 343F 3440 
       3441 3442 
0645   3442 3443 3444 01171         DT      .66,.67,.68,.69,.70,.70,.71,.72,.73,.73,.74,.75,.76,.77,.77,.78,.79,.80,.80,.81,.82,.83,
                            .84
       3445 3446 3446 
       3447 3448 3449 
       3449 344A 344B 
       344C 344D 344D 
       344E 344F 3450 
       3450 3451 3452 
       3453 3454 
065C   3454 3455 3456 01172         DT      .84,.85,.86,.87,.88,.88,.89,.90,.91,.91,.92,.93,.94,.95,.95,.96,.97,.98,.98,.99,.100,.10
                            1,.102
       3457 3458 3458 
       3459 345A 345B 
       345B 345C 345D 
       345E 345F 345F 
       3460 3461 3462 
       3462 3463 3464 
       3465 3466 
0673   3466 3467 3468 01173         DT      .102,.103,.104,.105,.105,.106,.107,.108,.109,.109,.110,.111,.112,.113,.113,.114,.115,.11
                            6,.116
       3469 3469 346A 
       346B 346C 346D 
       346D 346E 346F 
       3470 3471 3471 
       3472 3473 3474 
       3474 
0686   3475 3476 3477 01174         DT      .117,.118,.119,.120,.120,.121,.122,.123,.123,.124,.125,.126,.127,.127,.128,.129,.130,.13
                            0,.131
       3478 3478 3479 
       347A 347B 347B 
       347C 347D 347E 
       347F 347F 3480 
       3481 3482 3482 
       3483 
0699   3484 3485 3486 01175         DT      .132,.133,.134,.134,.135,.136,.137,.138,.138,.139,.140,.141,.141,.142,.143,.144,.145,.14
                            5,.146
       3486 3487 3488 
       3489 348A 348A 
       348B 348C 348D 
       348D 348E 348F 
       3490 3491 3491 
       3492 
06AC   3493 3494 3494 01176         DT      .147,.148,.148,.149,.150,.151,.152,.152,.153,.154,.155,.155,.156,.157,.158,.159,.159,.16
                            0,.161
       3495 3496 3497 
       3498 3498 3499 
       349A 349B 349B 
       349C 349D 349E 
       349F 349F 34A0 
       34A1 
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

06BF   34A2 34A3 34A3 01177         DT      .162,.163,.163,.164,.165,.166,.166,.167,.168,.169,.170,.170,.171,.172,.173,.173,.174,.17
                            5,.176
       34A4 34A5 34A6 
       34A6 34A7 34A8 
       34A9 34AA 34AA 
       34AB 34AC 34AD 
       34AD 34AE 34AF 
       34B0 
06D2   34B1 34B1 34B2 01178         DT      .177,.177,.178,.179,.180,.180,.181,.182,.183,.184,.184,.185,.186,.187,.188,.188,.189,.19
                            0,.191
       34B3 34B4 34B4 
       34B5 34B6 34B7 
       34B8 34B8 34B9 
       34BA 34BB 34BC 
       34BC 34BD 34BE 
       34BF 
06E5   34BF 34C0 34C1 01179         DT      .191,.192,.193,.194,.195,.195,.196,.197,.198,.198,.199
       34C2 34C3 34C3 
       34C4 34C5 34C6 
       34C6 34C7 
                      01180 
                      01181 ;-----------------------------------------------------------------------
                      01182 ;           Таблица преобразования показаний расхода топлива
                      01183 ;-----------------------------------------------------------------------
                      01184 ;       ORG     700
                      01185 ;Fuel
                      01186 ; include F_485.asm
                      01187 
                      01188 
                      01189 
                      01190 
                      01191 ; Вывод двоичных символов (для отладки)
                      01192 HEXWIEV let     temp1,39
06F0   3039               M         movlw   39
06F1   00C8               M         movwf   temp1
06F2   0E26           01193         SWAPF   ERR,W
06F3   390F           01194         ANDLW   0FH
06F4   3E30           01195         ADDLW   30
06F5   02C8           01196         SUBWF   temp1,F
06F6   1C03           01197         BTFSS   STATUS,C
06F7   3E07           01198         ADDLW   7
                      01199 
06F8   2343           01200         CALL    sch_b
                      01201         let     temp1,39
06F9   3039               M         movlw   39
06FA   00C8               M         movwf   temp1
06FB   0826           01202         Movfw   ERR
06FC   390F           01203         ANDLW   0FH
06FD   3E30           01204         ADDLW   30
06FE   02C8           01205         SUBWF   temp1,F
06FF   1C03           01206         BTFSS   STATUS,C
0700   3E07           01207         ADDLW   7
0701   2343           01208         CALL    sch_b
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0702   0008           01209         RETURN
                      01210 ;=============================
                      01211 ; Вывод скорости
                      01212 ;============================
0703   0854           01213 SPEEDW  Movfw   SPDCNTl
0704   00E1           01214         MOVWF   aargb2
0705   0853           01215         Movfw   SPDCNTh
0706   00E2           01216         MOVWF   aargb1
0707   22E9           01217         CALL    BCD16   ;Преобразование к десятичному виду
                      01218 
0708   085B           01219         MOVF    rab,w   ;Десятки Тысяч на дисплей
0709   3E30           01220         ADDLW   30
070A   2343           01221         CALL    sch_b
070B   085C           01222         MOVF    rab0,w  ;Тысячи на дисплей
070C   3E30           01223         ADDLW   30
070D   2343           01224         CALL    sch_b
070E   085D           01225         MOVF    rab1,w  ;Сотни на дисплей
070F   3E30           01226         ADDLW   30
0710   2343           01227         CALL    sch_b
0711   085E           01228         MOVF    rab2,w  ;Десятки на дисплей
0712   3E30           01229         ADDLW   30
0713   2343           01230         CALL    sch_b
0714   085F           01231         MOVF    rab3,w  ;Единицы на дисплей
0715   3E30           01232         ADDLW   30
0716   2343           01233         CALL    sch_b
0717   3020           01234         MOVLW   20
0718   2343           01235         CALL    sch_b
0719   3020           01236         MOVLW   20
071A   2343           01237         CALL    sch_b
071B   3020           01238         MOVLW   20
071C   2343           01239         CALL    sch_b
071D   3020           01240         MOVLW   20
071E   2343           01241         CALL    sch_b
071F   0008           01242         RETURN
                      01243 
0720                  01244 APROXIMIZER
                      01245 
                      01246         movab   APRX_B_IND,FSR  ; ЗАГРУЖАЕМ СЧЁТЧИК БАЙТ В РЕГИСТР КОСВЕННОЙ АДРЕСАЦИИ  
0720   087E               M         movfw   APRX_B_IND
0721   0084               M         movwf   FSR
0722   30A0           01247         MOVLW   0A0H            ; Добавляем начало блока переменных
0723   0784           01248         ADDWF   FSR,F           ; Приращаем FSR на начальное значение
0724   081A           01249         Movfw   RCREG
0725   07D1           01250         ADDWF   CHK_SUM_RX,F    ; считаем контрольную сумму
                      01251         bank1
0726   1683               M         bsf     STATUS,RP0
0727   1303               M         bcf     STATUS,RP1
0728   0080           01252         MOVWF   INDF            ; Сохраняем во временный буфер памяти
                      01253         bank0
0729   1283               M         bcf     STATUS,RP0
072A   1303               M         bcf     STATUS,RP1
                      01254 
                      01255 
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 38


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01256 
                      01257 
                      01258 
                      01259 
                      01260 
                      01261         END
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 39


SYMBOL TABLE
  LABEL                             VALUE 

ADDEN                             00000003
ADEN                              00000003
AF                                00000020
APROXIMIZER                       00000720
APRX_BUFF                         00000068
APRX_B_IND                        0000007E
A_TMP                             00000028
BBB                               00000022
BCD16                             000002E9
BLINK                             00000057
BRGH                              00000002
BRGHT                             000001FD
BRIGHT                            PORTA,4
BR_DWN                            00000202
BR_NEXT                           00000204
BR_UP                             000001FF
BT_CNT                            0000004F
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CC                                0000006D
CCC                               00000023
CCNXT                             00000070
CCP1CON                           00000017
CCP1IE                            00000002
CCP1IF                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCPR1                             00000015
CCPR1H                            00000016
CCPR1L                            00000015
CHK_SUM                           0000026B
CHK_SUM_RX                        00000051
CHSM_ERR                          000002C1
CIS                               00000003
CLR_DISP                          00000001
CLT                               000000A9
CLT_EX                            000000C0
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             0000001F
CMIE                              00000006
CMIF                              00000006
COLT                              00000029
CREN                              00000004
CSRC                              00000007
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 40


SYMBOL TABLE
  LABEL                             VALUE 

Char                              00000047
Colt1                             00000052
DATA_CP_OFF                       00003FFF
DATA_CP_ON                        00003EFF
DC                                00000001
DDD                               00000024
DD_RAM_ADDR                       00000080
DD_RAM_UL                         00000080
DELAY                             000002DA
DESL                              00000195
DISP_OFF                          00000008
DISP_ON                           0000000C
DISP_ON_B                         0000000F
DISP_ON_C                         0000000E
D_TPS                             0000003E
DispEr                            00000056
E                                 PORTB,3
ECON                              0000017A
EEADR                             0000009B
EECON1                            0000009C
EECON2                            0000009D
EEDATA                            0000009A
EEIE                              00000007
EEIF                              00000007
ENR_12                            0000003F
ENTRY_DEC                         00000004
ENTRY_DEC_S                       00000005
ENTRY_INC                         00000006
ENTRY_INC_S                       00000007
ERR                               00000026
ExtConfig                         00000041
F                                 00000001
FERR                              00000002
FLAG                              0000004C
FLAG2                             0000004D
FSR                               00000004
FUEL                              000001A4
FUNCTION_SET                      00000028
GET_SIZE                          0000024A
GET_VERSION                       00000242
GIE                               00000007
HEXWIEV                           000006F0
H_byte                            00000066
IAT                               00000043
INDF                              00000000
INIT                              0000001B
INJ_LAG_H                         00000032
INJ_LAG_L                         00000031
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IN_CNT                            00000050
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 41


SYMBOL TABLE
  LABEL                             VALUE 

IRP                               00000007
Int_Rx                            00000228
LAMBDA_CHAR                       000003E4
LCD_DATA                          00000006
LCD_DATA_TRIS                     00000086
LCD_Init                          0000038D
LCHR                              000003CE
LEVL                              000001F9
LINE1                             00000080
LINE2                             000000C0
LOGO                              00000400
LPG_CHAR                          000003BD
LPG_CHAR_S                        0000020B
LPG_FULL                          b'10101010'
LPG_L                             b'10101110'
LPG_L1                            b'10100010'
LPG_L2                            b'10100100'
LPG_L3                            b'10100110'
LPG_LEVEL                         00000058
LPG_NULL                          b'10100001'
LTR                               0000019D
L_byte                            00000067
MAP                               0000002A
MAP_OFF                           00000139
MAP_Tr                            0000012B
MAP_Trans                         00000500
MAP_Trans2                        00000600
MAR_EX                            0000013C
MCH                               000003D4
MCKh                              00000038
MCKl                              00000037
MUL8                              0000031E
MULT                              
MULc                              00000064
MULp                              00000065
NN                                0000005C
NNN                               00000021
NOT_BO                            00000000
NOT_BOD                           00000000
NOT_BOR                           00000000
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_T1SYNC                        00000002
NOT_TO                            00000004
NUL                               0000023A
N_CON                             00000410
O2S                               0000002C
OERR                              00000001
OLDMAP                            00000125
OPTION_REG                        00000081
OSCF                              00000003
PCL                               00000002
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 42


SYMBOL TABLE
  LABEL                             VALUE 

PCLATH                            0000000A
PCLATH_TEMP                       0000004B
PCON                              0000008E
PEIE                              00000006
PIE1                              0000008C
PIR1                              0000000C
PORTA                             00000005
PORTB                             00000006
POWER                             0000002D
PR2                               00000092
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RA6                               00000006
RA7                               00000007
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RCIE                              00000005
RCIF                              00000005
RCO_H                             00000036
RCO_L                             00000035
RCREG                             0000001A
RCSTA                             00000018
RD                                00000000
READ_DATA                         00000257
READ_STR                          000002C5
RET                               00000014
RP0                               00000005
RP1                               00000006
RS                                PORTA,3
RTN_HOME                          00000002
RW                                PORTA,2
RX9                               00000006
RX9D                              00000000
RqFh                              00000034
RqFl                              00000033
SAME                              00000001
SCR1                              00000114
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 43


SYMBOL TABLE
  LABEL                             VALUE 

SET_CGRAM                         000003AD
SHIFT_C_L                         00000010
SHIFT_C_R                         00000014
SHIFT_S_L                         00000018
SHIFT_S_R                         0000001C
SIZE                              0000004E
SPBRG                             00000099
SPD                               0000002E
SPDCNTh                           00000053
SPDCNTl                           00000054
SPD_ENR                           00000044
SPEED                             00000055
SPEEDW                            00000703
SPEN                              00000007
SREN                              00000005
STAT                              00000025
STATUS                            00000003
STATUS_TEMP                       0000004A
STPCNT                            00000027
SYM_BO                            0000042B
SYM_DEG                           0000043B
SYM_DOT                           0000041B
SYM_FUEL                          00000443
SYM_F_ER                          0000045B
SYM_L                             00000433
SYM_LAMBD                         0000044B
SYM_O                             00000423
SYM_V                             00000453
SYNC                              00000004
Send_Char                         00000343
Send_Cmd                          00000356
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1OSCEN                           00000003
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
TMR0                              00000001
TMR0IE                            00000005
TMR0IF                            00000002
TMR1                              0000000E
TMR1CS                            00000001
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 44


SYMBOL TABLE
  LABEL                             VALUE 

TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TMR_EV                            00000213
TMR_OF                            00000223
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TPS                               0000002B
TRISA                             00000085
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISA6                            00000006
TRISA7                            00000007
TRISB                             00000086
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRMT                              00000001
TX9                               00000006
TX9D                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXREG                             00000019
TXSTA                             00000098
T_INJ_H                           00000030
T_INJ_L                           0000002F
Temp                              00000046
UOZ                               00000042
VEH                               00000161
VERSION                           010H
VR0                               00000000
VR1                               00000001
VR2                               00000002
VR3                               00000003
VRCON                             0000009F
VREN                              00000007
VROE                              00000006
VRR                               00000005
W                                 00000000
WARM_20                           0000003A
WARM_40                           0000003C
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 45


SYMBOL TABLE
  LABEL                             VALUE 

WARM_50                           0000003D
WARM_80                           00000039
WARM_ENR                          00000045
WHEEL                             00000219
WR                                00000001
WREN                              00000002
WRERR                             00000003
W_TEMP                            0000007F
Wait_Busy                         00000369
Z                                 00000002
_BODEN_OFF                        00003FBF
_BODEN_ON                         00003FFF
_BOREN_OFF                        00003FBF
_BOREN_ON                         00003FFF
_CONFIG                           00002007
_CPD_OFF                          00003FFF
_CPD_ON                           00003EFF
_CP_OFF                           00003FFF
_CP_ON                            00001FFF
_DEVID1                           00002006
_ER_OSC_CLKOUT                    00003FFF
_ER_OSC_NOCLKOUT                  00003FFE
_EXTCLK_OSC                       00003FEF
_FOSC_ECIO                        00003FEF
_FOSC_EXTRCCLK                    00003FFF
_FOSC_EXTRCIO                     00003FFE
_FOSC_HS                          00003FEE
_FOSC_INTOSCCLK                   00003FFD
_FOSC_INTOSCIO                    00003FFC
_FOSC_LP                          00003FEC
_FOSC_XT                          00003FED
_HS_OSC                           00003FEE
_IDLOC0                           00002000
_IDLOC1                           00002001
_IDLOC2                           00002002
_IDLOC3                           00002003
_INTOSC_OSC_CLKOUT                00003FFD
_INTOSC_OSC_NOCLKOUT              00003FFC
_INTRC_OSC_CLKOUT                 00003FFD
_INTRC_OSC_NOCLKOUT               00003FFC
_LP_OSC                           00003FEC
_LVP_OFF                          00003F7F
_LVP_ON                           00003FFF
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FF7
_RC_OSC_CLKOUT                    00003FFF
_RC_OSC_NOCLKOUT                  00003FFE
_WDTE_OFF                         00003FFB
_WDTE_ON                          00003FFF
_WDT_OFF                          00003FFB
_WDT_ON                           00003FFF
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 46


SYMBOL TABLE
  LABEL                             VALUE 

_XT_OSC                           00003FED
__16F628A                         00000001
aargb1                            00000062
aargb2                            00000061
adjBCD                            00000313
adjDEC                            00000309
bank0                             
bank1                             
bank2                             
bank3                             
cnt1                              00000059
cnt2                              0000005A
conv                              000000C3
count                             00000060
d100mks                           000002E3
del10mks                          00000383
delay20                           000002C7
delay5                            000002D0
dll                               000002E5
jc                                
jnc                               
jnz                               
jz                                
let                               
loop16                            000002F0
movab                             
rab                               0000005B
rab0                              0000005C
rab1                              0000005D
rab2                              0000005E
rab3                              0000005F
res1                              0000003B
res2                              00000040
sch_b                             00000343
scmd                              00000356
temp                              00000063
temp1                             00000048
temp2                             00000049


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

0000 : XX--XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
MPASM  5.51                       DISPLAY.ASM   11-3-2021  20:45:19         PAGE 47


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)


0100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
01C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0200 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0240 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0280 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
02C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0300 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0340 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0380 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
03C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXX------- ----------------
0400 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0440 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXX------------- ----------------
0500 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0540 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0580 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
05C0 : XXXXXXXXXXXXXXXX XXXXXXX--------- ---------------- ----------------
0600 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0640 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0680 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
06C0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
0700 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXX----- ----------------
2000 : -------X-------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used:  1612
Program Memory Words Free:   436


Errors   :     0
Warnings :     0 reported,     0 suppressed
Messages :     0 reported,    21 suppressed

